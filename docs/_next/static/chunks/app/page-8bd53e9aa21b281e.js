(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{46919:function(e,t,s){Promise.resolve().then(s.bind(s,6009))},6009:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return s2}});var n=s(57437),a=s(99136),r=s(7155),i=s(33269),l=s(2265),o=s(33253),c=s(12781),d=s(70895),u=s(29835),h=s(90144),m=s(69905),x=s(58237),p=s(66910);let g=/[\r\n]+/,y=/\*/,j=/\*/g,f=/([\[\]\(\)*?^$.+])/g,b=/^;|;$/g,Z=/([\[\]\(\)?^$.+])/g;function v(e){return";"+e.replace(Z,"\\$&").replace(j,"[^;]*")+";"}function C(e,t){return e.length-t.length}function w(e,t){return t&&-1!==e?(1-e/t)*100:0}let _=/\./g;function k(e){return";"+e.replace(_,"[^;]")+";"}let S=/^.*[/\\]/;function E(e){return e.replace(S,"")}let O={resources:3,building:1,coarse_sense_map:1};function z(e){return new Promise(t=>{let s=indexedDB.open("dictionary_builder_"+e,O[e]);s.onupgradeneeded=()=>{let t=s.result;t.objectStoreNames.contains(e)&&t.deleteObjectStore(e),t.createObjectStore(e,{keyPath:"name"})},s.onsuccess=()=>{t(s.result)}})}let N={setItem:async function(e,t){let s=await z(t);return new Promise(n=>{if(s){let a=s.transaction([t],"readwrite",{durability:"relaxed"}).objectStore(t).put(e);a.onerror=t=>{throw Error("failed to store item "+e.name)},a.onsuccess=()=>n(!0)}else throw Error})},getItem:async function(e,t){let s=await z(t);return new Promise(n=>{if(s){let a=s.transaction([t],"readonly",{durability:"relaxed"}).objectStore(t).get(e);a.onerror=()=>n(null),a.onsuccess=()=>{n(a.result)}}else n(null)})},removeItem:async function(e,t){let s=await z(t);return new Promise(n=>{if(s){let a=s.transaction([t],"readwrite",{durability:"relaxed"}).objectStore(t).delete(e);a.onerror=()=>n(!1),a.onsuccess=()=>n(!0)}else n(!1)})}};async function F(e){let t=new Blob([JSON.stringify(e)]).stream().pipeThrough(new CompressionStream("gzip")).getReader(),s=[];for(;;){let{done:e,value:n}=await t.read();if(e)break;s.push(n)}return new Blob(s)}async function P(e){let t=e.stream().pipeThrough(new DecompressionStream("gzip"));return await new Response(t).json()}let M={},T=new TextEncoder;async function A(e,t,s){if(!(e in M)){let n=await crypto.subtle.importKey("raw",T.encode(t),{name:"PBKDF2"},!1,["deriveKey"]);M[e]={salt:s,key:await crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e6,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}}return M[e]}async function W(e,t,s){let n=s?await A(e,s,crypto.getRandomValues(new Uint8Array(16))):M[e];if(n)try{let e=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:e},n.key,new Uint8Array(await (await F(t)).arrayBuffer()));return new Blob([e,n.salt,s])}catch(t){console.error("failed to encrypt "+e)}}function D(e){return new Promise(async t=>{t(await fetch("data:application/octet-stream;base64,"+e.substring(1)).then(e=>e.blob()))})}async function I(e,t,s){let n=await ("string"==typeof t?(await D(t)).arrayBuffer():t.arrayBuffer()),a=s?await A(e,s,new Uint8Array(n,12,16)):M[e];if(a)try{let e=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(n,0,12)},a.key,new Uint8Array(n,28));return P(new Blob([e]))}catch(e){}}async function R(e){return await N.getItem(e,"resources")}async function L(e,t){N.setItem({name:e,encrypted:!1,content:await F(t)},"resources")}async function K(e,t){delete M[e],N.removeItem(t+e,"coarse_sense_map"===e?e:"building"),localStorage.removeItem(t+e)}async function B(e,t,s,n,a){let r=!!a||e in M,i=await (r?W(e,s,a):F(s));if(i)try{n?N.setItem({name:t+e,encrypted:r,content:i},"coarse_sense_map"===e?e:"building"):localStorage.setItem(t+e,await new Promise(e=>{let t=new FileReader;t.readAsDataURL(i),t.onloadend=async()=>{e((r?"e":"c")+t.result.split(";base64,")[1])}}))}catch(t){console.error("failed to store "+e)}}let q=new Map,H={running:""};async function V(e,t,s,n,a,r){let i=t+e;if(!q.has(i)){q.set(i,[...arguments]);let t=e=>{q.delete(i),s(e);let t=q.keys().next();if(t.value){H.running=t.value;let e=q.get(t.value);e&&(q.delete(t.value),V.apply(void 0,e))}};if(1===q.size&&(H.running=i),i===H.running){let s="coarse_sense_map"===e?e:"building",l=n?await N.getItem(i,"coarse_sense_map"===i?i:s):localStorage.getItem(i);if(l||(l=n?localStorage.getItem(i):await N.getItem(i,s)),l){if("string"==typeof l&&("{"===l[0]||"c"===l[0]))t("{"===l[0]?JSON.parse(l):await P(await D(l)));else if("string"==typeof l||l.encrypted){let s="string"==typeof l?l:l.content;e in M?t(await I(e,s)):a(e,()=>async n=>{if(n){let a=await I(e,s,n);if(a)t(a);else throw q.delete(i),delete M[e],Error}else t()})}else t(await P(l.content))}else t(r)}}}let G={};async function U(e,t,s,n){V(e,"dict_history_",e=>{e&&t(e)},n,s,{edits:[],position:-1})}async function J(e,t,s,n){e in G?t(G[e]):V(e,"dict_",s=>{s&&(G[e]=s,t(s))},n,s,{})}async function $(e,t){V("coarse_sense_map","original_",s=>{V("coarse_sense_map","",t=>t?e(t,s,!1):void 0,!0,t,{})},!0,t,void 0)}let Y=(0,l.createContext)({senseMap:{},SenseLookup:{},NLTKLookup:{},collapsedSenses:"",collapsedNLTK:""}),X=(0,l.createContext)((e,t,s,n)=>{}),Q=[{key:"terms",label:"Terms"},{key:"termAssociations",label:"Term Associations"},{key:"sense_keys",label:"Sense Keys"},{key:"synsetInfo",label:"Synset Info"}],ee=/[\s-]+/g;function et(e){let{children:t}=e,[s,a]=(0,l.useState)(),[r,i]=(0,l.useState)(),[y,j]=(0,l.useState)(),[f,b]=(0,l.useState)(),[Z,v]=(0,l.useState)(),[C,w]=(0,l.useState)(),[_,k]=(0,l.useState)(),[S,E]=(0,l.useState)({}),[O,z]=(0,l.useState)(),[N,F]=(0,l.useState)({}),[M,T]=(0,l.useState)({}),[A,W]=(0,l.useState)(""),[D,I]=(0,l.useState)(""),[K,q]=(0,l.useState)(!0),[H,V]=(0,l.useState)(!0),[G,U]=(0,l.useState)(!0),[J,$]=(0,l.useState)(!0);(0,l.useEffect)(()=>{R("terms").then(e=>{e&&e.content?P(e.content).then(e=>{a(Object.freeze(e.arr)),j(Object.freeze(e.obj)),b(Object.freeze(e.collapsed)),q(!1)}):fetch("/dictionary_builder/data/terms.txt").then(e=>e.text()).then(e=>{let t=Object.freeze(e.split(g));a(t);let s={all:";;"+t.join(";;")+";;"},n={};t.forEach((e,t)=>{n[e]=t;let a=e[0];a&&(a in s?s[a]+=e+";;":s[a]=";;"+e+";;")}),j(Object.freeze(n)),b(Object.freeze(s)),L("terms",{arr:t,obj:n,collapsed:s})}).finally(()=>q(!1))})},[q]),(0,l.useEffect)(()=>{R("term_associations").then(e=>{e&&e.content?P(e.content).then(e=>{v(e),V(!1)}):fetch("/dictionary_builder/data/term_associations.json").then(e=>e.json()).then(e=>{v(e),L("term_associations",e)}).finally(()=>V(!1))})},[V]),(0,l.useEffect)(()=>{R("sense_keys").then(e=>{e&&e.content?P(e.content).then(e=>{w(Object.freeze(e)),U(!1)}):fetch("/dictionary_builder/data/sense_keys.txt").then(e=>e.text()).then(e=>{let t=e.split(g);w(Object.freeze(t)),L("sense_keys",t)}).finally(()=>U(!1))})},[U]),(0,l.useEffect)(()=>{R("synset_info").then(e=>{e&&e.content?P(e.content).then(e=>{k(e),$(!1)}):fetch("/dictionary_builder/data/synset_info.json").then(e=>e.json()).then(e=>{let t=e.map((e,t)=>(e.index=t,e));k(t),L("synset_info",t)}).finally(()=>$(!1))})},[$]),(0,l.useEffect)(()=>{if(s&&Z){let e={};Z.forEach((t,n)=>{if(t.length){let a=t[0],r="number"==typeof a?a:a.length?a[0]:0;if(r){let t=s[n],a=s[r-1],i=e[a];i&&"function"!=typeof i?"number"==typeof i?e[a]=[r-1,i,n]:i.push(n):e[a]=[r-1,n],e[t]=r-1}}}),i(e)}},[s,Z]),(0,l.useEffect)(()=>{if(s&&C&&_){let e={},t={};_.forEach((n,a)=>{if(e[C[a]]=a,n.sense_index&&n.members){let e=n.sense_index+"",r="number"==typeof n.members?n.members:n.members[0];if(r){let i=s[r-1].replace(ee,"_")+"."+n.id.substring(n.id.length-1)+"."+(1===e.length?"0":"")+e;t[i]=a,n.nltk_id=i}}}),F(e),T(t),W(";;"+C.join(";;")+";;"),I(";;"+Object.keys(t).join(";;")+";;")}},[s,C,_]);let et=(0,l.useMemo)(()=>({terms:s,lemmas:r,termLookup:y,collapsedTerms:f,termAssociations:Z,sense_keys:C,synsetInfo:_,senseMap:S,senseMapRaw:O,NLTKLookup:M,SenseLookup:N,collapsedSenses:A,collapsedNLTK:D}),[s,r,y,f,Z,C,_,S,O,M,N,A,D]),es={terms:K,termAssociations:H,sense_keys:G,synsetInfo:J};return(0,n.jsx)(Y.Provider,{value:et,children:r&&_?(0,n.jsx)(X.Provider,{value:(e,t,s,n)=>{E(e),s&&B("coarse_sense_map","",e,!0,n),t&&(z(t),s&&B("coarse_sense_map","original_",t,!0,n))},children:t}):(0,n.jsxs)(d.Z,{sx:{margin:"auto",marginTop:10,maxWidth:350},children:[(0,n.jsx)(u.Z,{variant:"h4",children:"Loading Resources..."}),(0,n.jsx)(h.Z,{children:Q.map(e=>{let{key:t,label:s}=e;return(0,n.jsxs)(m.ZP,{dense:!0,children:[(0,n.jsx)(x.Z,{sx:{minWidth:"35px",mb:1},children:et[t]?(0,n.jsx)(o.Z,{color:"success"}):es[t]?(0,n.jsx)(p.Z,{size:"1.5rem"}):(0,n.jsx)(c.Z,{color:"error",sx:{marginBottom:-.8}})}),(0,n.jsxs)(u.Z,{children:[et[t]||es[t]?"":"Failed to load ",s]})]},t)})})]})})}var es=s(3837),en=s(99528),ea=s(43206),er=s(36892),ei=s(85195),el=s(47002),eo=s(95996),ec=s(10470),ed=s(87640),eu=s(47533),eh=s(98899),em=s(54272),ex=s(72921),ep=s(28738),eg=s(6285),ey=s(60036),ej=s(40512),ef=s(67147),eb=s(89969);function eZ(e){let{label:t,message:s,onConfirm:a}=e,[r,i]=(0,l.useState)(!1),o=()=>i(!r);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{fullWidth:!0,color:"error",onClick:o,children:t}),r&&(0,n.jsxs)(ey.Z,{open:r,onClose:o,children:[(0,n.jsx)(ej.Z,{children:"Confirm"}),(0,n.jsx)(ea.Z,{"aria-label":"close export menu",onClick:o,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{children:(0,n.jsx)(u.Z,{children:s})}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsx)(eg.Z,{onClick:o,children:"Cancel"}),(0,n.jsx)(eg.Z,{variant:"contained",color:"error",onClick:()=>{a(),o()},children:t})]})]})]})}var ev=s(22922),eC=s(94972),ew=s(58836),e_=s(41848),ek=s(82794),eS=s(8472),eE=s(19038);let eO=(0,ew.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),ez=/^"|"$/g,eN=/"*,"*/,eF=/[\r\n]+/,eP=/%/;function eM(){let{sense_keys:e,SenseLookup:t,NLTKLookup:s}=(0,l.useContext)(Y),[a,r]=(0,l.useState)(!1),i=()=>r(!a),[o,c]=(0,l.useState)(!0),[h,m]=(0,l.useState)(!1),[x,p]=(0,l.useState)([]),[g,y]=(0,l.useState)([]),[j,f]=(0,l.useState)(["",""]),[b,Z]=(0,l.useState)(!1),[v,C]=(0,l.useState)([0,0,0]),[w,_]=(0,l.useState)({}),[k,S]=(0,l.useState)(""),[E,O]=(0,l.useState)(!0),z=(0,l.useContext)(X),N=()=>{p([]),y([]),S("")},F=(n,a,r)=>{let i=function(e,t,s){let n={};if(e&&-1!==t&&-1!==s)try{e.forEach(e=>{let a=e[t],r=e[s];if(a&&r&&r.length){if(a in n){let e=n[a];e.includes(r)||e.push(r)}else n[a]=[r]}})}catch(e){}return n}(n,a,r),l={},o=Object.keys(i);if(o.length&&e){let n=!eP.test(o[0]);Z(n);let a=n?s:t,r=new Set,c=0;o.forEach(t=>{let o=i[t];"string"==typeof o?r.add(o):o.forEach(e=>r.add(e)),t in a&&(c++,l[n?e[s[t]]:t]=o)}),C([o.length,c,r.size])}_(l)},P=e=>{if(e.length>1){let t=e.splice(0,1)[0].replace(ez,"").split(eN),s=e.map(e=>e.replace(ez,"").split(eN));y(Object.freeze(s)),p(t),t.length>1&&(f([t[0],t[1]]),F(s,0,1))}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{variant:"outlined",onClick:i,children:"Import"}),(0,n.jsxs)(ey.Z,{open:a,onClose:i,onDrop:e=>{if(e.preventDefault(),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){let t=e.dataTransfer.files[0],s=new FileReader;s.onload=()=>{P(s.result.split(eF))},s.readAsText(t)}},children:[(0,n.jsx)(ej.Z,{children:"Import Coarse Sense Mappings"}),(0,n.jsx)(ea.Z,{"aria-label":"close coarse sense import menu",onClick:i,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsxs)(ef.Z,{sx:{p:1,minWidth:"400px"},children:[g.length>1?(0,n.jsxs)(d.Z,{spacing:1,direction:"row",children:[(0,n.jsxs)(em.Z,{sx:{width:"50%"},children:[(0,n.jsx)(eh.Z,{title:"Name of the column containing fine-grained sense labels (such as sense keys).",placement:"left",children:(0,n.jsxs)(e_.Z,{fullWidth:!0,children:[(0,n.jsx)(ek.Z,{id:"fine_sense_select",children:"Fine Senses"}),(0,n.jsx)(eS.Z,{labelId:"fine_sense_select",label:"Fine Senses",size:"small",value:j[0],onChange:e=>{let t=e.target.value,s=[t,j[j[1]===t?0:1]];F(g,x.indexOf(s[0]),x.indexOf(s[1])),f(s)},children:x.map((e,t)=>(0,n.jsx)(eE.Z,{value:e,children:e},e+t))})]})}),(0,n.jsxs)(u.Z,{sx:{pl:2},variant:"caption",children:[(0,n.jsxs)("span",{className:"number",children:[v[1]," "]}),"of",(0,n.jsxs)("span",{className:"number",children:[" ",v[0]," "]}),"recognized"]})]}),(0,n.jsxs)(em.Z,{sx:{width:"50%"},children:[(0,n.jsx)(eh.Z,{title:"Name of the column containing coarse-grained sense labels (such as sense clusters).",placement:"right",children:(0,n.jsxs)(e_.Z,{fullWidth:!0,children:[(0,n.jsx)(ek.Z,{id:"coarse_sense_select",children:"Coarse Senses"}),(0,n.jsx)(eS.Z,{labelId:"coarse_sense_select",label:"Coarse Senses",size:"small",value:j[1],onChange:e=>{let t=e.target.value,s=[j[j[0]===t?1:0],t];F(g,x.indexOf(s[0]),x.indexOf(s[1])),f(s)},children:x.map((e,t)=>(0,n.jsx)(eE.Z,{value:e,children:e},e+t))})]})}),(0,n.jsxs)(u.Z,{sx:{pl:2},variant:"caption",children:[(0,n.jsxs)("span",{className:"number",children:[" ",v[2]," "]}),"unique labels"]})]})]}):(0,n.jsx)(u.Z,{sx:{p:2},children:"Select a CSV file with columns containing fine- and coarse-gained sense labels."}),(0,n.jsxs)(d.Z,{spacing:1,children:[(0,n.jsxs)(d.Z,{spacing:2,direction:"row",sx:{justifyContent:"flex-end"},children:[(0,n.jsx)(eh.Z,{title:"Store the imported map locally.",placement:"top",children:(0,n.jsx)(ed.Z,{label:"Store",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{checked:o,onChange:()=>c(!o)})})}),o?(0,n.jsx)(eh.Z,{title:"Encrypt the sense map when being stored.",placement:"right",children:(0,n.jsx)(ed.Z,{label:"Encrypt",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{checked:h,onChange:()=>m(!h)})})}):(0,n.jsx)(n.Fragment,{})]}),o&&h?(0,n.jsxs)(em.Z,{children:[(0,n.jsx)(ex.Z,{fullWidth:!0,size:"small",label:"Password",type:E?"password":"text",value:k,onChange:e=>S(e.target.value)}),(0,n.jsx)(ea.Z,{sx:{position:"absolute",right:15},"aria-label":"toggle password visibility",onClick:()=>O(!E),children:E?(0,n.jsx)(ev.Z,{}):(0,n.jsx)(eC.Z,{})})]}):(0,n.jsx)(n.Fragment,{})]})]}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsxs)(d.Z,{direction:"row",spacing:1,children:[(0,n.jsx)(eh.Z,{title:"select a file to import a coarse sense map from",children:(0,n.jsxs)(eg.Z,{variant:"outlined",component:"label",children:["File",(0,n.jsx)(eO,{type:"file",onChange:e=>{if(e.target.files&&e.target.files.length){let t=e.target.files[0],s=new FileReader;s.onload=()=>{P(s.result.split(eF)),e.target.value=""},s.readAsText(t)}}})]})}),(0,n.jsx)(eh.Z,{title:"clear any loaded content",children:(0,n.jsx)(eg.Z,{onClick:N,children:"clear"})})]}),(0,n.jsx)(eg.Z,{variant:"contained",disabled:!!h&&!k,onClick:()=>{z(w,{header:x,selectedCols:j,rows:g,NLTKLabels:b},o,k),N(),r(!1)},children:"Set"})]})]})]})}var eT=s(368),eA=s(952);function eW(){let e=(0,eT.Z)(),{senseMap:t,senseMapRaw:s,synsetInfo:a,sense_keys:r,SenseLookup:i,NLTKLookup:o}=(0,l.useContext)(Y),[c,h]=(0,l.useState)(!1),m=()=>h(!c),[x,p]=(0,l.useState)("coarse_sense_map"),[g,y]=(0,l.useState)(!!s&&s.NLTKLabels),[j,f]=(0,l.useState)(!!s),b=(0,l.useMemo)(()=>{let e=[j&&s?s.header.join(","):'"fine_sense","coarse_sense"'],n=Object.keys(t);if(n.length>1&&r&&a){if(j&&s){let{header:l,selectedCols:c,rows:d,NLTKLabels:u}=s,h=l.indexOf(c[0]),m=l.indexOf(c[1]);if(-1!==h&&-1!==m){let s={};d.forEach(n=>{let l=u?r[o[n[h]]]:n[h],c=n[m];if(l in t&&-1!==t[l].indexOf(c)){let t=[...n];u&&!g?t[h]=r[o[n[h]]]:!u&&g&&l in i&&(t[h]=a[i[l]].nltk_id),e.push(t.join(",")),s[t[h]+c]=!0}}),n.forEach(n=>{let r=t[n];if(g&&n in i){let{nltk_id:e}=a[i[n]];n=e}let o=l.length;r.forEach(t=>{let a=n+t;if(n&&t&&!(a in s)){let s=Array(o);s[h]=n,s[m]=t,e.push(s.join(","))}})})}}else n.forEach(s=>{let n=t[s];if(g&&s in i){let{nltk_id:e}=a[i[s]];s=e}s&&n&&n.forEach(t=>e.push('"'+s+'","'+t+'"'))})}return e.length>1?e.join("\n"):""},[c,g,j]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{variant:"outlined",onClick:m,children:"Export"}),c&&(0,n.jsxs)(ey.Z,{open:c,onClose:m,children:[(0,n.jsx)(ej.Z,{children:"Export Coarse Sense Map"}),(0,n.jsx)(ea.Z,{"aria-label":"close export menu",onClick:m,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{sx:{p:1},children:(0,n.jsxs)(d.Z,{spacing:1,children:[(0,n.jsx)(ex.Z,{size:"small",label:"Filename",value:x,onChange:e=>{p(e.target.value)}}),(0,n.jsxs)(e_.Z,{children:[(0,n.jsx)(eA.Z,{sx:{fontSize:".8em"},htmlFor:"export_content",children:"Export Content"}),(0,n.jsx)("textarea",{id:"export_content",style:{backgroundColor:e.palette.background.default,color:e.palette.text.primary,whiteSpace:"pre",minWidth:"35em",minHeight:"20em"},value:b,readOnly:!0})]})]})}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:g,onChange:()=>y(!g)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"NLTK-Style Labels"}),labelPlacement:"top"}),(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:j,onChange:()=>f(!j),disabled:!s}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Match Import Format"}),labelPlacement:"top"}),(0,n.jsx)(eg.Z,{variant:"contained",onClick:()=>{if(x&&b){let e=document.createElement("a");e.setAttribute("href",URL.createObjectURL(new Blob([b],{type:"text/plain"}))),e.setAttribute("download",x+".csv"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}},children:"Download"})]})]})]})}var eD=s(96684),eI=s(98455),eR=s(54784),eL=s(62640),eK=s(4938),eB=s(24541);function eq(e){let{coarseLabels:t,useNLTK:s}=e,[a,r]=(0,l.useState)(!1),i=()=>r(!a),{senseMap:o}=(0,l.useContext)(Y),c=(0,l.useContext)(X),[u,h]=(0,l.useState)([]),[m,x]=(0,l.useState)(""),[p,g]=(0,l.useState)([]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{sx:{position:"absolute",left:16,bottom:16},onClick:i,children:"New Pairs"}),(0,n.jsxs)(ey.Z,{open:a,onClose:i,children:[(0,n.jsx)(ej.Z,{children:"Sense Mappings"}),(0,n.jsx)(ea.Z,{"aria-label":"close sense map editor",onClick:i,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsxs)(ef.Z,{sx:{p:1,minWidth:"500px"},children:[(0,n.jsx)(eB.Z,{sx:{mb:1},children:"Define fine to coarse sense mappings:"}),(0,n.jsxs)(d.Z,{direction:"row",spacing:1,children:[(0,n.jsx)(t7,{selected:u,setSelected:h,multi:!0,useNLTK:s}),(0,n.jsx)(eI.Z,{componentsProps:{popper:{className:"synset-select"}},multiple:!0,disableCloseOnSelect:!0,options:t,value:p,onChange:(e,t)=>g([...t]),renderTags:(e,t)=>e.map((e,s)=>(0,l.createElement)(eR.Z,{label:e,...t({index:s}),key:e})),inputValue:m,onInputChange:(e,t)=>x(t),renderInput:e=>(0,n.jsx)(ex.Z,{...e,size:"small",label:"Coarse Senses"}),filterSelectedOptions:!0,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,freeSolo:!0})]})]}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsx)(eg.Z,{onClick:i,children:"Cancel"}),(0,n.jsx)(eg.Z,{variant:"contained",onClick:()=>{let e={...o};u.forEach(t=>{if(t in o){let s=[...e[t]];p.forEach(e=>{s.includes(e)||s.push(e)}),e[t]=s}else e[t]=p}),c(e),h([]),g([]),i()},children:"Add"})]})]})]})}var eH=s(80874),eV=s(94589),eG=s(4558),eU=s(64845),eJ=s(86520),e$=s(30412),eY=s(98430),eX=s(20360),eQ=s(48286),e0=s(97902),e1=s(92293);function e2(e){let{senseKey:t,info:s}=e,a=(0,l.useContext)(tn);return(0,n.jsx)(eh.Z,{title:s.definition,placement:"right",children:(0,n.jsx)(e1.Z,{underline:"none",sx:{p:0,justifyContent:"flex-start",cursor:"pointer",display:"block"},onClick:()=>a({type:"add",state:{type:"synset",value:t,info:s}}),children:t})})}function e5(e,t){return Array.isArray(e)?e.map(e=>t[e-1]):[t[e-1]]}function e3(e,t,s){let n=new Set(e5(e.members,t));return Object.keys(e).forEach(a=>{if("members"!==a&&"index"!==a){var r;(Array.isArray(r=e[a])?"number"==typeof r[0]?r.map(e=>s[e-1]):[]:"number"==typeof r?[s[r-1]]:[]).forEach(e=>{e5(e.members,t).forEach(e=>n.add(e))})}}),Array.from(n)}function e8(e){let{name:t,info:s}=e,a=s[t],r=(0,l.useContext)(sc),i=(0,l.useContext)(sd),o=(0,l.useContext)(tn),{terms:c,sense_keys:d,synsetInfo:m}=(0,l.useContext)(Y);return c&&d&&m?(0,n.jsxs)(em.Z,{sx:{m:1},children:[(0,n.jsx)(u.Z,{variant:"h5",children:t}),(0,n.jsx)(h.Z,{children:"string"==typeof a?a:"members"===t?c?Array.isArray(a)?a.map(e=>tZ(c[e-1],r,i,o)):tZ(c[a-1],r,i,o):(0,n.jsx)(n.Fragment,{}):Array.isArray(a)?a.map(e=>{let t=m[e-1];return(0,n.jsx)(e2,{senseKey:d[e-1],info:t},e)}):(0,n.jsx)(e2,{senseKey:d[a-1],info:m[a-1]})})]},t):(0,n.jsx)(n.Fragment,{})}let e9={id:0,index:0,ili:0,definition:0,topic:0,csi_labels:0,wikidata:0,source:0,sense_index:0,nltk_id:0},e6={a:"adj",r:"adv",s:"adj",n:"noun",v:"verb"};function e4(e){let{info:t}=e,{sense_keys:s,senseMap:a}=(0,l.useContext)(Y),r=s?s[t.index]:"",i=r&&r in a?a[r]:t.csi_labels;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.Z,{variant:"h6",children:t.definition}),(0,n.jsxs)(d.Z,{direction:"row",spacing:2,children:[(0,n.jsxs)(em.Z,{children:[(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Open English WordNet ID: ",(0,n.jsx)("span",{className:"number",children:t.id})]}),t.ili?(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Interlingual ID: ",(0,n.jsx)("span",{className:"number",children:t.ili})]}):(0,n.jsx)(n.Fragment,{}),t.nltk_id?(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Natural Language Toolkit ID: ",(0,n.jsx)("span",{className:"number",children:t.nltk_id})]}):(0,n.jsx)(n.Fragment,{})]}),(0,n.jsxs)(em.Z,{children:[(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Part of Speech:"," ",(0,n.jsx)("span",{className:"number",children:e6[t.id.substring(t.id.length-1)]})]}),(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Topic: ",(0,n.jsx)("span",{className:"number",children:t.topic})]}),i?(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Coarse Labels: ",(0,n.jsx)("span",{className:"number",children:"string"==typeof i?i:i.join(", ")})]}):(0,n.jsx)(n.Fragment,{})]}),t.wikidata||t.source?(0,n.jsxs)(em.Z,{children:[t.source?(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Source: ",(0,n.jsx)("span",{className:"number",children:t.source})]}):(0,n.jsx)(n.Fragment,{}),t.wikidata?(0,n.jsxs)(u.Z,{component:"p",variant:"caption",sx:{ml:1},children:["Wikidata:"," ",(0,n.jsx)(e1.Z,{href:"https://www.wikidata.org/wiki/"+t.wikidata,rel:"noreferrer",target:"_blank",children:t.wikidata})]}):(0,n.jsx)(n.Fragment,{})]}):(0,n.jsx)(n.Fragment,{})]}),(0,n.jsx)(d.Z,{direction:"row",sx:{mt:2},children:Object.keys(t).filter(e=>!(e in e9)).map(e=>(0,n.jsx)(e8,{name:e,info:t},e))})]})}let e7=(0,l.createContext)(""),te=(0,l.createContext)((e,t)=>{});function tt(e){let{categories:t,editor:s,width:a}=e,r=(0,l.useContext)(Y),i=(0,l.useContext)(sc),o=(0,l.useContext)(e7),c=(0,l.useContext)(te),h=(0,l.useContext)(sd),[m,x]=(0,l.useState)(!1);if(!o||!(o in i))return(0,n.jsx)(n.Fragment,{});let p=t9(o,r,i),g=i[o],y=(0,l.useMemo)(()=>[{field:"id",headerName:"Name",width:108},{field:"from_term_editor",headerName:"Weight",width:65,editable:!0,hideable:!1,valueParser:(e,t)=>{let n=+e||"";return t&&s(n,t),n}}],[]),j=g.categories,f=[];return t.forEach(e=>{(m||e in j)&&f.push({id:e,term_id:o,from_term_editor:j[e]||"",dictEntry:g,processed:p})}),(0,n.jsx)(em.Z,{sx:{position:"absolute",top:0,right:"-"+a+"px",height:"100%",width:a+"px"},children:(0,n.jsxs)(ei.Z,{sx:{height:"100%",pb:"1em"},elevation:1,children:[(0,n.jsx)(el.Z,{sx:{p:.5},action:(0,n.jsx)(ea.Z,{"aria-label":"Close term editor",onClick:()=>c(""),className:"close-button",children:(0,n.jsx)(en.Z,{})}),title:(0,n.jsx)(u.Z,{sx:{whiteSpace:"nowrap","& .MuiButtonBase-root":{fontWeight:"bold",fontSize:"1.1em"}},children:(0,n.jsx)(tC,{term:p.term})})}),(0,n.jsx)(eo.Z,{sx:{p:.5,height:"100%"},children:(0,n.jsxs)(d.Z,{direction:"column",sx:{pb:1,pt:1,height:"100%",overflowY:"auto"},spacing:2,children:[(0,n.jsx)(tg,{label:"Sense",id:o,field:"",processed:p}),(0,n.jsxs)(d.Z,{direction:"column",spacing:1,sx:{height:"100%"},children:[(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Category Weights"}),(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:m,onChange:()=>x(!m)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Show Empty"}),labelPlacement:"start"}),(0,n.jsx)(eL._$,{sx:{minHeight:"140px"},className:"bottom-search datagrid-vertical",rows:f,columns:y,disableRowSelectionOnClick:!0,disableDensitySelector:!0,disableColumnMenu:!0,pageSizeOptions:[100],density:"compact",onCellKeyDown:(e,t)=>{if("Delete"===t.key||"Backspace"===t.key){let n=""+e.value,a="view"===e.cellMode?0:+n.substring(0,n.length-1);s(a,e),a||t.preventDefault()}}}),(0,n.jsx)(eg.Z,{fullWidth:!0,variant:"contained",onClick:()=>{h({type:"add",term:g.term||o,term_type:g.type,sense:g.sense,categories:{...g.categories},added:g.added})},children:"Duplicate"})]})]})})]})})}let ts=(0,l.createContext)([]),tn=(0,l.createContext)(e=>{});function ta(e){let{term:t}=e,s=(0,l.useContext)(sc),a=(0,l.useContext)(sd),r=t in s;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eo.Z,{sx:{overflowY:"auto",pb:0,pt:0},children:(0,n.jsx)(tw,{term:t})}),(0,n.jsx)(ep.Z,{sx:{justifyContent:"flex-end",mt:"auto"},children:(0,n.jsx)(eg.Z,{onClick:()=>{a(r?{type:"remove",term_id:t}:{type:"add",term:t,term_type:"fixed"})},children:r?"Remove":"Add"})})]})}function tr(e){let{info:t}=e;return(0,n.jsx)(eo.Z,{sx:{overflowY:"auto",mb:"auto",pt:0},children:(0,n.jsx)(e4,{info:t})})}let ti=-1;function tl(e){let{height:t,setHeight:s}=e,a=(0,l.useContext)(sc),r=(0,l.useContext)(tn),i=(0,l.useContext)(si),o=(0,l.useContext)(sl),c=(0,l.useContext)(te),h=(0,l.useContext)(ts),m=(0,l.useCallback)(e=>{let n=Math.max(16.2,Math.min(Math.ceil((1-e.y/window.innerHeight)*100),87));n!==t&&(cancelAnimationFrame(ti),ti=requestAnimationFrame(()=>{s(n),window.dispatchEvent(new Event("resize"))}))},[s]),x=(0,l.useCallback)(e=>{e.preventDefault(),document.body.style.cursor="row-resize",window.addEventListener("mousemove",m)},[m]);if((0,l.useEffect)(()=>{let e=e=>{if(e.preventDefault(),-1!==ti){cancelAnimationFrame(ti),ti=-1,document.body.style.cursor="default",window.removeEventListener("mousemove",m);let t=Math.max(16.2,Math.min(Math.ceil((1-e.y/window.innerHeight)*100),87));s(t),i.info_drawer_height=t,o({...i}),localStorage.setItem("dictionary_builder_settings",JSON.stringify(i)),window.dispatchEvent(new Event("resize"))}};return window.addEventListener("mouseup",e),()=>window.removeEventListener("mouseup",e)},[m,i,o,s]),!h.length)return;let p=()=>{r({type:"reset"})},g=h[0];return(0,n.jsx)(er.ZP,{open:""!==g.value,onClose:p,variant:"permanent",hideBackdrop:!0,anchor:"bottom",sx:{"& .MuiPaper-root":{height:t+"vh",display:"flex",flexDirection:"column",justifyContent:"space-between"}},children:(0,n.jsxs)(ei.Z,{children:[(0,n.jsx)(em.Z,{sx:{backgroundColor:"#757575",height:"3px",width:"100%",position:"absolute",cursor:"row-resize"},onMouseDownCapture:x}),(0,n.jsx)(el.Z,{action:(0,n.jsx)(ea.Z,{"aria-label":"Close info drawer",onClick:p,className:"close-button",children:(0,n.jsx)(en.Z,{})}),title:(0,n.jsxs)(d.Z,{direction:"row",children:[h.length>1?(0,n.jsx)(eg.Z,{onClick:()=>r({type:"back"}),sx:{opacity:.8},children:h[1].value}):(0,n.jsx)(n.Fragment,{}),g.value in a?(0,n.jsx)(eg.Z,{sx:{textTransform:"none",p:0},onClick:()=>c(g.value),children:(0,n.jsx)(u.Z,{variant:"h3",children:g.value})}):(0,n.jsx)(u.Z,{variant:"h3",children:g.value})]})}),"term"===g.type?(0,n.jsx)(ta,{term:g.value}):(0,n.jsx)(tr,{info:g.info})]})})}let to=/[aeiouy]$/;function tc(e,t){let s,n;let a=new Set,r=(e=e.replace(f,"\\$&")).length;try{s=r>3?RegExp(";(?:anti|de|dis|central|en|ex|faux|hyper|il|ill|in|intra|inter|ir|meso|mal|mid|middle|mis|miss|non|over|pan|post|pre|pro|re|retro|sudo|sub|super|un|uber|under|ultra|trans)?-?"+e+(to.test(e)?"*":"+")+"-?(?:'|ac|age|al|alize|ance|ancy|ant|ary|at|ate|ation|cracy|cy|cycle|d|dom|ed|ence|ency|ent|er|es|esque|est|ette|ey|ful|hood|ial|ic|ie|ies|ify|in|ing|ion|ionate|isation|ish|ise|ism|ist|ive|ize|ization|let|lets|lette|like|ling|lings|log|ly|ley|ment|n|nce|ness|ng|nt|or|on|ous|r|s|ship|st|t|th|ties|ty|ur|ward|wise|y|z)?(?:'|al|alize|alization|ate|ation|ble|d|ed|er|es|ility|in|ing|ion|ise|isation|ish|ize|ization|ly|ness|ous|s|y|z)?;","g"):RegExp(";(?:de|un|re)?-?"+(r>2?e.replace(to,"[aeiouy]"):e)+"+-?(?:'|d|ed|er|en|ing|s|y)?;","g")}catch(e){}if(s)for(;n=s.exec(t);){let t=n[0];t&&t.length-1>r&&";"+e+";"!==t&&a.add(t.replace(b,""))}return Array.from(a)}var td=s(91955),tu=s(31190),th=s(15187),tm=s(19109),tx=s(59968),tp=s(99541);function tg(e){let{id:t,field:s,processed:a,label:r,editCell:i}=e,o=(0,l.useContext)(sc),c=(0,l.useContext)(sd),d=o[t||a.term],h=(0,l.useContext)(Y),{terms:m,senseMap:x,sense_keys:p,synsetInfo:g}=h,y=(e,t)=>{let s=e in x?x[e]:t.csi_labels;return"string"==typeof s?s:s[0]},j=(0,l.useMemo)(()=>{if(!m||!p||!g||"fixed"!==a.type||!a.synsets.length)return[];{let e=function(e,t){let s={};return Object.keys(t).forEach(n=>{let a=t[n];e.forEach(e=>{e in a.categories&&(s[n]=a)})}),s}(Object.keys(d.categories),o),t={};Object.keys(e).forEach(e=>{let s=t9(e,h,o,!0);s.lookup&&s.lookup.map.forEach((e,s)=>t[s]=!0)});let s={},n=a.synsets.map(n=>{let a=0;e3(n,m,g).forEach(s=>{s in e&&a++,s in t&&(a+=.01)}),n.csi_labels||(n.csi_labels="no category");let r=p[n.index],i=y(r,n);return i in s&&!(s[i]<a)||(s[i]=a),{key:r,score:a,synset:n}}),r=n.map(e=>{let{key:t,synset:s}=e;return y(t,s)}).sort();return n.sort((e,t)=>{let n=y(e.key,e.synset),a=s[n],i=-r.indexOf(n),l=y(t.key,t.synset);return 100*s[l]+-(.1*r.indexOf(l))+.01*t.score-(100*a+.1*i+.01*e.score)})}},[m,x,p,g,a,o,h,d]);return m&&p&&g&&"fixed"===a.type&&a.synsets.length?(0,n.jsx)(eI.Z,{size:"small",componentsProps:{popper:{className:"synset-select"}},options:j,value:d.sense,groupBy:e=>y(e.key,e.synset),getOptionLabel:e=>"string"==typeof e?e:e.key,renderOption:(e,t)=>{let{key:s,synset:a,score:r}=t;return delete e.key,(0,n.jsx)(eE.Z,{value:s,...e,children:(0,n.jsx)(eh.Z,{title:a.definition,placement:"right",children:(0,n.jsxs)(u.Z,{sx:{width:"100%"},children:[(0,n.jsx)("span",{className:"number-annotation",children:"("+r.toFixed(2)+") "}),p[a.index]]})})},s)},renderInput:e=>(0,n.jsx)(ex.Z,{label:r,...e}),ListboxProps:{style:{cursor:"pointer"},onClick:e=>{let n=e.target;if("tagName"in n&&"innerText"in n&&"DIV"===n.tagName){let e=n.innerText;i&&i({id:t,field:s,value:e}),c({type:"update",term_id:t,term:a.term,term_type:a.term_type,sense:e})}}},onChange:(e,n)=>{let r=n&&"object"==typeof n&&n.key||"";i&&i({id:t,field:s,value:r}),c({type:"update",term_id:t,term:a.term,term_type:a.term_type,sense:r})},autoSelect:!0,blurOnSelect:!0,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,freeSolo:!0}):(0,n.jsx)(ex.Z,{size:"small",value:d.sense,onChange:e=>{i&&i({id:t,field:s,value:e.target.value}),c({type:"update",term_id:t,term:a.term,term_type:a.term_type,sense:e.target.value})},label:r})}let ty=["Match","Frequency","Senses","Related","In Dictionary"],tj={position:"absolute",fontSize:"1.5em",height:"1.2em",opacity:.4};function tf(e){let{processed:t}=e,s=(0,l.useContext)(sc),a=(0,l.useContext)(sd),r=(0,l.useContext)(Y),[i,o]=(0,l.useState)(0),[c,d]=(0,l.useState)(5),[h,m]=(0,l.useState)({column:"Frequency",asc:!1}),x=(0,l.useMemo)(()=>[(0,n.jsx)(eG.Z,{width:1},"term_action"),...ty.map(e=>(0,n.jsxs)(eG.Z,{width:"Match"===e?999:1,component:"th",align:"Match"===e?"left":"right",sx:{cursor:"pointer",pr:3},onClick:()=>{m(h.column===e&&h.asc?{column:"Frequency",asc:!1}:{column:e,asc:h.column===e})},children:[e,h.column===e?h.asc?(0,n.jsx)(td.Z,{sx:tj}):(0,n.jsx)(tu.Z,{sx:tj}):(0,n.jsx)(n.Fragment,{})]},e))],[m,h]),p=t.matches.length,g=(0,l.useMemo)(()=>t.matches.map(e=>{let t=t9(e,r);return t.frequency=w(t.index,r.terms&&r.terms.length),t.in_dict=t.term in s,t}),[t,r,s]);if(i>p/c)return o(0),(0,n.jsx)(n.Fragment,{});g.sort(function(e){let{column:t,asc:s}=e;switch(t){case"Match":return s?(e,t)=>e.term>t.term?-1:1:(e,t)=>t.term>e.term?-1:1;case"Frequency":return s?(e,t)=>(e.frequency||0)-(t.frequency||0):(e,t)=>(t.frequency||0)-(e.frequency||0);case"Senses":return s?(e,t)=>e.synsets.length-t.synsets.length:(e,t)=>t.synsets.length-e.synsets.length;case"Related":return s?(e,t)=>e.related.length-t.related.length:(e,t)=>t.related.length-e.related.length;case"In Dictionary":return s?(e,t)=>(e.in_dict||0)>(t.in_dict||0)?-1:1:(e,t)=>(t.in_dict||0)>(e.in_dict||0)?-1:1}}(h));let y=[];if(p)for(let e=i*c,t=Math.min(g.length,e+c);e<t;e++)y.push(g[e]);if(!t.common_matches){let e="";t.matches.forEach(t=>{(!e||t.length<e.length)&&(e=t)}),t.common_matches=tc(e,";;"+t.matches.join(";;")+";;")}return(0,n.jsx)(em.Z,{sx:{height:"100%",overflowY:"auto"},children:p?(0,n.jsxs)(eU.Z,{sx:{height:"100%"},children:[(0,n.jsxs)(eJ.Z,{stickyHeader:!0,size:"small",sx:{width:"100%","& .MuiTableCell-root:first-of-type":{pl:1}},children:[(0,n.jsx)(e$.Z,{children:(0,n.jsx)(eY.Z,{children:x})}),(0,n.jsx)(eX.Z,{children:y.map((e,t)=>{let s=e.term;return(0,n.jsxs)(eY.Z,{sx:{height:33},hover:!0,children:[(0,n.jsx)(eG.Z,{sx:{p:0},children:e.in_dict?(0,n.jsx)(ea.Z,{"aria-label":"remove",size:"small",edge:"start",sx:{p:0,opacity:.6},onClick:()=>{a({type:"remove",term_id:s})},children:(0,n.jsx)(th.Z,{})}):(0,n.jsx)(ea.Z,{"aria-label":"add",size:"small",edge:"start",sx:{p:0,opacity:.6},onClick:()=>{a({type:"add",term_id:s,term:s,term_type:"fixed"})},children:(0,n.jsx)(tm.Z,{})})}),(0,n.jsx)(eG.Z,{children:(0,n.jsx)(tC,{term:s})}),(0,n.jsx)(eG.Z,{align:"right",children:e.frequency&&e.frequency.toFixed(2)||"0.00"}),(0,n.jsx)(eG.Z,{align:"right",children:e.synsets.length}),(0,n.jsx)(eG.Z,{align:"right",children:e.related.length}),(0,n.jsx)(eG.Z,{align:"right",children:e.in_dict?"yes":"no"})]},s+t)})})]}),(0,n.jsx)(eQ.Z,{component:"div",rowsPerPageOptions:[5,10,50,100,1e3],count:p,rowsPerPage:c,page:i,onPageChange:(e,t)=>{o(t)},onRowsPerPageChange:e=>{d(parseInt(e.target.value)),o(0)}})]}):(0,n.jsx)(u.Z,{children:"No matches"})})}let tb={minWidth:"20px",opacity:.9,"& .MuiSvgIcon-root":{fontSize:"1em"}};function tZ(e,t,s,a){let r=e in t2?t2[e]:"",i=e in t,l=i&&t[e].term||e;return(0,n.jsxs)(m.ZP,{disableGutters:!0,disablePadding:!0,sx:{pr:3},secondaryAction:i?(0,n.jsx)(ea.Z,{"aria-label":"remove",size:"small",edge:"end",sx:tb,onClick:()=>{s({type:"remove",term_id:e})},children:(0,n.jsx)(th.Z,{})}):(0,n.jsx)(ea.Z,{"aria-label":"add",size:"small",edge:"end",sx:tb,onClick:()=>{s({type:"add",term_id:e,term:l,term_type:"fixed"})},children:(0,n.jsx)(tm.Z,{})}),children:[(0,n.jsx)(x.Z,{sx:tb,children:i?(0,n.jsx)(eh.Z,{title:"in current dictionary",placement:"left",children:(0,n.jsx)(tx.Z,{color:"success"})}):r&&r in t?(0,n.jsx)(eh.Z,{title:"captured by "+r+" in current dictionary",placement:"left",children:(0,n.jsx)(ea.Z,{sx:{p:0,"& .MuiSvgIcon-root":{fontSize:".7em"}},onClick:()=>{a({type:"add",state:{type:"term",value:r}})},children:(0,n.jsx)(tp.Z,{color:"secondary"})})}):(0,n.jsx)(n.Fragment,{})}),(0,n.jsx)(tC,{term:l})]},e)}function tv(e){let{processed:t}=e,s={p:1,pl:0,maxHeight:"100%",overflowY:"auto",overflowX:"hidden"},a=(0,l.useContext)(sc),r=(0,l.useContext)(sd),i=(0,l.useContext)(tn),{terms:o,senseMap:c,termLookup:x,collapsedTerms:p,sense_keys:g}=(0,l.useContext)(Y),y=(0,l.useCallback)(x?(e,t)=>x[e]-x[t]:()=>0,[x]);t.forms||(t.forms=tc(t.term,p?p.all:""),t.forms.sort(C));let j={};return t.synsets&&t.synsets.map(e=>{let t=g?g[e.index]:"",s=t in c?c[t]:e.csi_labels||"no category",n="string"==typeof s?s:s[0];n in j?j[n].push(e):j[n]=[e]}),(0,n.jsxs)(d.Z,{direction:"row",spacing:4,sx:{height:"100%"},children:[(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(eh.Z,{title:"100 - index / n terms * 100; terms are loosely sorted by frequency and space coverage",children:(0,n.jsx)(u.Z,{children:"Relative Frequency"})}),(0,n.jsx)(em.Z,{sx:{p:1},children:(0,n.jsx)("span",{className:"number",children:w(t.index,o&&o.length).toFixed(2)})})]}),o&&t.lemma.length?(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{children:"Lemmatizer"}),(0,n.jsx)(em.Z,{sx:s,children:(0,n.jsx)(h.Z,{disablePadding:!0,sx:{p:0},children:t.lemma.filter(e=>e!==t.term).map(e=>tZ(e,a,r,i))})})]}):(0,n.jsx)(n.Fragment,{}),t.forms.length?(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{children:"Expansion"}),(0,n.jsx)(em.Z,{sx:s,children:(0,n.jsx)(h.Z,{disablePadding:!0,sx:{p:0},children:t.forms.map(e=>tZ(e,a,r,i))})})]}):(0,n.jsx)(n.Fragment,{}),t.related.length?(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{children:"Related Terms"}),(0,n.jsx)(em.Z,{sx:s,children:(0,n.jsx)(h.Z,{disablePadding:!0,sx:{p:0},children:t.related.map(e=>tZ(e,a,r,i))})})]}):(0,n.jsx)(n.Fragment,{}),g&&t.synsets.length?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{children:"Senses"}),(0,n.jsx)(em.Z,{sx:{...s,p:0},children:(0,n.jsx)(h.Z,{subheader:(0,n.jsx)("li",{}),className:"term-sense-list",children:Object.keys(j).map(e=>{let t=j[e];return(0,n.jsx)("li",{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)(e0.Z,{children:e}),t.map(e=>(0,n.jsx)(m.ZP,{disablePadding:!0,children:(0,n.jsx)(e2,{senseKey:g[e.index],info:e})},e.index))]})},e)})})})]}),t.synset_terms.length?(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{children:"Extended Synset Members"}),(0,n.jsx)(em.Z,{sx:s,children:(0,n.jsx)(h.Z,{disablePadding:!0,sx:{p:0},children:t.synset_terms.sort(y).map(e=>tZ(e,a,r,i))})})]}):(0,n.jsx)(n.Fragment,{})]}):(0,n.jsx)(n.Fragment,{})]})}function tC(e){let{term:t}=e,s=(0,l.useContext)(tn);return(0,n.jsx)(eg.Z,{fullWidth:!0,variant:"text",sx:{p:0,justifyContent:"flex-start",textTransform:"none"},onClick:()=>s({type:"add",state:{type:"term",value:t}}),children:t})}function tw(e){let{term:t}=e,s=t9(t,(0,l.useContext)(Y),(0,l.useContext)(sc));return"fixed"===s.type?(0,n.jsx)(tv,{processed:s}):(0,n.jsx)(tf,{processed:s})}var t_=s(76676),tk=s(79768),tS=s(18203),tE=s(16498),tO=s(660),tz=s(3238),tN=s(70537),tF=s(90451);function tP(e){e&&e._chartsViews&&e._chartsViews.forEach(e=>{e._layouting&&(e._layouting=!1,clearTimeout(e._layoutTimeout))})}function tM(e){let{nodes:t,edges:s,options:a}=e,r=(0,l.useContext)(te),i=(0,l.useContext)(tn),o=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=o.current?(0,tS.S1)(o.current,"dark",{renderer:"canvas"}):null,t=()=>e&&e.resize();return e&&e.on("click",e=>{("node"===e.dataType||"graphGL"===e.componentSubType)&&(r(e.name,!0),i({type:"add",state:{type:"term",value:e.name}}))}),window.addEventListener("resize",t),()=>{e&&(tP(e),e.dispose()),window.removeEventListener("resize",t)}},[a.layout]),(0,l.useEffect)(()=>{if(o.current){let e=(0,tS.JE)(o.current);if(e){if(tP(e),a.hide_zeros&&(t=t.filter(e=>!!e.value)),t=t.map(e=>(e.label={show:e.value>=a.label_threshold},e)),s.length){let n={};t.forEach(e=>{"string"!=typeof e.category&&(e.category=e.category[0]),n[e.category]=!0,e.symbolSize=a.size_by_value?7+18*e.prop:10});let r=Object.keys(n).map(e=>({name:e}));e.setOption({legend:{align:"right",right:"right",orient:"vertical",type:"plain",pageButtonGap:10},tooltip:{confine:!0,formatter:e=>e.marker+(e.data.host?"<i>("+e.data.host+")</i> ":"")+e.name+": <strong>"+e.value.toFixed(3)+"</strong>"},backgroundColor:"#000",series:["forceAtlas2"===a.layout?{type:"graphGL",nodes:t,edges:s,categories:r,roam:!0,label:{show:!0,position:"top",color:"#fff"},lineStyle:{color:"source"},emphasis:{focus:"adjacency",lineStyle:{color:"#fff",opacity:1,width:10}}}:{type:"graph",layout:a.layout,nodes:t,edges:s,categories:r,roam:!0,label:{show:!0,position:"top"},emphasis:{focus:"adjacency",itemStyle:{opacity:1},label:{opacity:1},lineStyle:{width:10,opacity:1}},blur:{itemStyle:{opacity:.3},lineStyle:{opacity:.3},label:{opacity:.3}},autoCurveness:!0,draggable:!0,force:{repulsion:a.repulsion,gravity:a.gravity,edgeLength:a.edge_length},circular:{rotateLabel:!0},lineStyle:{color:"source"}}]},!1,"forceAtlas2"!==a.layout)}else e.clear()}}},[t,s,a]),(0,n.jsx)(em.Z,{ref:o,sx:{width:"100%",height:"100%",minHeight:"10px"}})}function tT(e,t){return{lemma:+(e in t.lemma),lemma_related:+(e in t.lemma_related),lemma_synset:+(e in t.lemma_synset),related:+(e in t.related),related_lemma:+(e in t.related_lemma),related_related:+(e in t.related_related),related_synset:+(e in t.related_synset),synset:+(e in t.synset),synset_lemma:+(e in t.synset_lemma),synset_related:+(e in t.synset_related),synset_synset:+(e in t.synset_synset)}}async function tA(e,t,s,n,a,r,i,l){clearTimeout(tX.comparisons);let o=Object.keys(t),c=o.length;for(let a=0;e<c&&a<100;a++,e++){let a=t[o[e]];a.processed.lookup.map.forEach((e,r)=>{let i=a.term+"."+r,o=r+"."+a.term;if(a.term!==r&&!(i in n)&&!(o in n)&&r in t){n[i]=n[o]=!0;let e=function(e,t,s){if(!t.processed)return 0;let n=tT(e.term,t.processed.lookup);return s?.35*n.lemma+.1*n.lemma_related+.001*n.lemma_synset+.25*n.related+.1*n.related_lemma+.001*n.related_related+.001*n.related_synset+.001*n.synset+.001*n.synset_lemma+.001*n.synset_related+.001*n.synset_synset:.35*n.lemma+.25*n.related+.001*n.synset}(a,t[r],l.dense);e>l.min_sim&&s.push({source:a.term,target:r,value:e,lineStyle:{width:.3+2*e,opacity:.35}})}})}r([e,c]),e<c?tX.comparisons=setTimeout(()=>tA(e,t,s,n,a,r,i,l),0):setTimeout(()=>{let e={},n=Object.values(t).map((t,s)=>(e[t.term]=s,{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,host:t.host||"",category:Object.keys(t.categories).sort((e,t)=>a[e]-a[t]),name:t.term,prop:1,value:0,symbolSize:10,itemStyle:{opacity:1},label:{show:!0}}));s.forEach(t=>{n[e[t.source]].value+=t.value,n[e[t.target]].value+=t.value});let r=0;n.forEach(e=>{let{value:t}=e;t>r&&(r=t)}),i({edges:s,nodes:n.map(e=>(e.prop=e.value/r,e.itemStyle={opacity:.6+.4*e.prop},e))})},0)}function tW(e){let{allTerms:t,catCounts:s,selectedCategories:a,options:r,plotOptions:i}=e,o=(0,l.useContext)(Y),c=(0,l.useContext)(sc),[h,m]=(0,l.useState)({edges:[],nodes:[]}),[x,p]=(0,l.useState)([0,0]);return(0,l.useEffect)(()=>{let e=new Map(a.map((e,t)=>[t,e])),n={};t.forEach((t,s)=>{let a=!1,i={};if(e.forEach(e=>{(e in t.categories||"no categories"===e&&!Object.keys(t.categories).length)&&(a=!0,i[e]=t.categories[e])}),a){let e=t9(s,o,c,!0);"fixed"===e.type?s in n||(n[s]={term:s,categories:i,processed:e}):r.include_fuzzy&&e.matches.forEach(e=>{e in c||e in n||(n[e]={host:s,term:e,categories:i,processed:t9(e,o,{},!0)})})}}),tA(0,n,[],{},s,p,m,r)},[c,o,r,a]),x[0]<x[1]?(0,n.jsx)(em.Z,{sx:{position:"relative",width:"100%",height:"100%"},children:(0,n.jsx)(em.Z,{sx:{display:"flex",position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",textAlign:"center"},children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.Z,{variant:"h5",children:"Calculating Pairwise Similarities"}),(0,n.jsx)(eV.Z,{variant:"determinate",value:x[0]/x[1]*100}),(0,n.jsx)(u.Z,{variant:"caption",children:x[0]+" / "+x[1]})]})})}):(0,n.jsx)(em.Z,{sx:{position:"relative",width:"100%",height:"100%"},children:(0,n.jsx)(tM,{nodes:h.nodes,edges:h.edges,options:i})})}function tD(e){let{name:t,current:s,edit:a}=e,r=(0,l.useContext)(Y),{terms:i,collapsedTerms:o,termLookup:c}=r,h=(0,l.useContext)(sc),m=(0,l.useMemo)(()=>{let e={};return Object.keys(h).forEach(t=>e[h[t].term||t]=!0),e},[h]),x=(0,l.useMemo)(()=>({all:";;"+Object.keys(m).join(";;")+";;"}),[m]),[p,g]=(0,l.useState)(!1),y=()=>g(!p),[b,Z]=(0,l.useState)(!0),[C,w]=(0,l.useState)(!0),[_,k]=(0,l.useState)(!0),[S,E]=(0,l.useState)(!0),[O,z]=(0,l.useState)(1),[N,F]=(0,l.useState)(""),[P,M]=(0,l.useState)([]),[T,A]=(0,l.useState)([]),W=S?e=>c&&e in c:e=>e in m,D=e=>{e&&!T.includes(e)&&W(e)&&A([...T,e])};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{onClick:y,fullWidth:!0,children:"Fill Weights"}),p&&(0,n.jsxs)(ey.Z,{open:p,onClose:y,children:[(0,n.jsx)(ej.Z,{children:"Category Weight Filler"}),(0,n.jsx)(ea.Z,{"aria-label":"close category weight filler",onClick:y,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{sx:{minWidth:"300px",minHeight:"300px",p:1},children:(0,n.jsxs)(d.Z,{spacing:2,children:[(0,n.jsx)(eh.Z,{title:C?"Weights will be similarity to the specified core terms":"Will use the specified value as the weight of all terms",placement:"right",children:(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:C,onChange:()=>w(!C)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Similarity-based"}),labelPlacement:"start"})}),C&&i?(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(eI.Z,{multiple:!0,disableCloseOnSelect:!0,options:P,onKeyUp:e=>{let t="value"in e.target?e.target.value:"";if(("Enter"===e.code||"NumpadEnter"===e.code)&&N&&(!t||t===N)){D(t);return}if(i){let e=[];if(t&&o){let s;try{s=RegExp(j.test(t)?v(t):";"+t+"[^;]*;","g")}catch(e){s=RegExp(";"+t.replace(f,"\\%&")+";","g")}t5("",s,S?o:x,e,100)}T.forEach(t=>{e.includes(t)||e.push(t)}),M(e)}},value:T,onChange:(e,t)=>{1===Math.abs(t.length-T.length)&&A([...t])},renderTags:(e,t)=>e.map((e,s)=>(0,l.createElement)(eR.Z,{label:e,...t({index:s}),key:e})),renderInput:e=>(0,n.jsx)(ex.Z,{...e,size:"small",label:"Core Terms",value:N,onChange:e=>{T.includes(e.target.value)||F(e.target.value)}}),filterOptions:e=>e,noOptionsText:"No matches",filterSelectedOptions:!0,selectOnFocus:!0,clearOnBlur:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0}),(0,n.jsxs)(t_.Z,{sx:{m:0,justifyContent:"space-between"},children:[(0,n.jsx)(eg.Z,{onClick:()=>{M([]),A([])},children:"Clear"}),(0,n.jsx)(eh.Z,{title:S?"Allowing any terms from the full list on record":"Allowing only terms included in the category",placement:"top",children:(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:S,onChange:()=>{M([]),E(!S)}}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Allow any terms"}),labelPlacement:"top"})}),(0,n.jsx)(eh.Z,{title:_?"Will rescaling similarities to be between 0 and 1":"Will display raw similarity values",placement:"top",children:(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:_,onChange:()=>k(!_)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Scale"}),labelPlacement:"top"})})]})]}):(0,n.jsx)(ex.Z,{fullWidth:!0,size:"small",label:"Value",value:O,onChange:e=>z(+e.target.value)}),(0,n.jsx)(eh.Z,{title:b?"Will apply weight to all terms in the dictionary":"Will apply weight only to terms with weight in the current category",placement:"right",children:(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:b,onChange:()=>Z(!b)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Apply to all terms"}),labelPlacement:"start"})})]})}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsx)(eg.Z,{onClick:y,children:"Cancel"}),(0,n.jsx)(eg.Z,{variant:"contained",onClick:()=>{let e={};if(C){let t=new Map;T.forEach(e=>{let s=t9(e,r,h,!0);"fixed"===s.type?t.set(e,s.lookup):s.matches.forEach(e=>{t.set(e,t9(e,r,h,!0).lookup)})});let n=[1/0,-1/0];Object.keys(b?m:s).forEach(s=>{let a=0;t.forEach(e=>{let t=t9(s,r,h);if("fixed"===t.type){let t=tT(s,e);a+=1*(t.lemma||t.related||t.synset)+.1*(t.lemma_related||t.lemma_synset)+.01*(t.related_lemma||t.related_related||t.related_synset)+.001*(t.synset_lemma||t.synset_related||t.synset_synset)}else t.matches.forEach(t=>{let s=tT(t,e);a+=1*(s.lemma||s.related||s.synset)+.1*(s.lemma_related||s.lemma_synset)+.01*(s.related_lemma||s.related_related||s.related_synset)+.001*(s.synset_lemma||s.synset_related||s.synset_synset)})}),_&&(n[0]>a&&(n[0]=a),n[1]<a&&(n[1]=a)),e[s]=a}),_&&Object.keys(e).forEach(t=>e[t]=(e[t]-n[0])/(n[1]-n[0]))}else b?Object.keys(h).forEach(t=>e[t]=O):Object.keys(s).forEach(t=>{s[t]&&(e[t]=O)});let n={};Object.keys(b?h:s).forEach(t=>{let s=h[t].term||t;s in e&&(n[t]=e[s])}),a({type:"reweight_category",name:t,weights:n}),y()},children:"Fill"})]})]})]})}function tI(e){let{category:t,onClose:s}=e,[a,r]=(0,l.useState)(!1),i=(0,l.useContext)(su),o=(0,l.useContext)(Y),c=(0,l.useContext)(sc),[h,m]=(0,l.useState)(t),[x,p]=(0,l.useState)(t);(0,l.useEffect)(()=>{p(t)},[t,p]),(0,l.useEffect)(()=>{m(x)},[x,m]);let g=(0,l.useContext)(sd),y=(0,l.useCallback)((e,s)=>{let{field:n,row:a}=s,{processed:r,dictEntry:i}=a;if(n){let n={...i.categories};t in n&&!e?delete n[t]:e&&(n[t]=e),g({type:"update",term_id:s.id,term:r.term,term_type:r.term_type,categories:n})}},[g,t]),j=(0,l.useMemo)(()=>new Map(Object.keys(c).map((e,t)=>[t,e])),[c]),f=(0,l.useMemo)(()=>{let e={};return j.forEach(s=>{let{categories:n}=c[s];t in n&&(e[s]=n[t])}),e},[c,j,t]),b=(0,l.useMemo)(()=>{let e=[];return j.forEach(t=>{if(a||t in f){let s=c[t];e.push({id:t,term:s.term?s.sense&&t!==s.term?s.term+"@"+s.sense:s.term:t,weight:f[t]||"",dictEntry:s,processed:t9(t,o,c)})}}),e},[o,c,j,a,f]);return t&&i.includes(t)?(0,n.jsxs)(ey.Z,{open:!!t,onClose:s,children:[(0,n.jsx)(ej.Z,{children:"Category Editor"}),(0,n.jsx)(ea.Z,{"aria-label":"close category editor",onClick:s,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{sx:{p:1,minWidth:"300px",height:"500px"},children:(0,n.jsxs)(d.Z,{sx:{height:"100%"},children:[(0,n.jsxs)(d.Z,{direction:"row",children:[(0,n.jsx)(ex.Z,{label:"Name",fullWidth:!0,value:h,onChange:e=>m(e.target.value),size:"small"}),h!==t?(0,n.jsx)(eg.Z,{variant:"contained",onClick:()=>{g({type:"rename_category",name:t,newName:h})},children:"Rename"}):(0,n.jsx)(n.Fragment,{})]}),(0,n.jsxs)(d.Z,{direction:"column",spacing:1,sx:{mt:2,height:"100%"},children:[(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Term Weights"}),(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:a,onChange:()=>r(!a)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Show Empty"}),labelPlacement:"start"}),(0,n.jsx)(eL._$,{className:"bottom-search datagrid-vertical",rows:b,columns:[{field:"term",headerName:"Term",width:170},{field:"weight",headerName:"Weight",width:95,editable:!0,hideable:!1,valueParser:(e,t)=>{let s=+e||"";return t&&y(s,t),s}}],disableRowSelectionOnClick:!0,disableDensitySelector:!0,disableColumnMenu:!0,pageSizeOptions:[100],density:"compact",slots:{toolbar:eK.T},onCellKeyDown:(e,t)=>{("Delete"===t.key||"Backspace"===t.key)&&"view"===e.cellMode&&y(0,e)}})]})]})}),(0,n.jsx)(eb.Z,{children:(0,n.jsx)(tD,{name:t,current:f,edit:g})})]}):(0,n.jsx)(n.Fragment,{})}(0,tk.D)([tE.N,tz.N,tF.N,tN.N,tO.N]);var tR=s(88433),tL=s(39340),tK=s(7291),tB=s(78502),tq=s(66164),tH=s(26009),tV=s(88555),tG=s(78371);let tU={ref:void 0};function tJ(e){if(tU.ref&&tU.ref.current){let t=tU.ref.current.state.sorting.sortedRows.indexOf(e);tU.ref.current.setPage(Math.floor(t/100)),tU.ref.current.selectRow(e,!0,!0),requestAnimationFrame(()=>{tU.ref&&tU.ref.current&&tU.ref.current.scrollToIndexes({rowIndex:t})})}}function t$(e){let{count:t,page:s,onPageChange:a}=e,r=Math.ceil(t/100)-1,i=0===s,l=s===r;return(0,n.jsxs)(d.Z,{direction:"row",children:[(0,n.jsx)(ea.Z,{"aria-label":"Go to first page",disabled:i,onClick:e=>a(e,0),children:(0,n.jsx)(tL.Z,{})}),(0,n.jsx)(ea.Z,{"aria-label":"Go to previous page",disabled:i,onClick:e=>a(e,s-1),children:(0,n.jsx)(tK.Z,{})}),(0,n.jsx)(ea.Z,{"aria-label":"Go to next page",disabled:l,onClick:e=>a(e,s+1),children:(0,n.jsx)(tB.Z,{})}),(0,n.jsx)(ea.Z,{"aria-label":"Go to last page",disabled:l,onClick:e=>a(e,r),children:(0,n.jsx)(tq.Z,{})})]})}function tY(e){let{rows:t,columns:s,isCategory:a,setEditCategory:r,editFromEvent:i}=e,o=(0,l.useContext)(te),c=(0,tV.A)();return tU.ref=c,(0,n.jsx)(eL._$,{apiRef:c,className:"bottom-search",rows:t,columns:s,showCellVerticalBorder:!0,disableDensitySelector:!0,pageSizeOptions:[100],density:"compact",slots:{toolbar:eK.T,columnMenu:e=>{let t=e.colDef.headerName;return a(t)?(0,n.jsx)(tG.hh,{...e,slots:{columnMenuUserItem:()=>(0,n.jsxs)(eE.Z,{onClick:()=>{r(t)},children:[(0,n.jsx)(x.Z,{children:(0,n.jsx)(tH.Z,{fontSize:"small"})}),(0,n.jsx)(tR.Z,{children:"Edit category"})]})},slotProps:{columnMenuIserItem:{displayOrder:15}}}):(0,n.jsx)(tG.hh,{...e})}},slotProps:{pagination:{ActionsComponent:t$}},onCellKeyDown:(e,t)=>{("Delete"===t.key||"Backspace"===t.key)&&i(0,e)},onRowClick:e=>{let{row:t}=e;o(t.id)}})}let tX={dictionary:0,comparisons:0};function tQ(e,t){return t.dictEntry.added-e.dictEntry.added}function t0(e){let{editFromEvent:t}=e,s=(0,l.useContext)(Y),a=(0,l.useContext)(sc),r=(0,l.useContext)(su),i=(0,l.useCallback)(e=>r.includes(e),[r]),o=(0,l.useContext)(sd),c=(0,l.useMemo)(()=>Object.freeze(Object.keys(a).map(e=>a[e].term||e).sort()),[a]),h=(0,l.useMemo)(()=>{let e=[{field:"remove",headerName:"",width:1,sortable:!1,disableColumnMenu:!0,renderCell:e=>(0,n.jsx)(ea.Z,{sx:{opacity:.4,cursor:"not-allowed"},size:"small","aria-label":"remove term",onClick:()=>{o({type:"remove",term_id:e.id})},children:(0,n.jsx)(eD.Z,{sx:{fontSize:".9em"}})})},{field:"term",headerName:"Term",renderCell:e=>(0,n.jsx)(tC,{term:e.value})},{field:"sense",headerName:"Sense",description:"assigned sense key",editable:!0,renderEditCell:e=>(0,n.jsx)(tg,{id:e.id,field:e.field,processed:e.row.processed,editCell:e.api.setEditCellValue})},{field:"frequency",headerName:"Frequency",description:"relative frequency; 100 - index / n terms * 100; terms are loosely sorted by frequency and space coverage"},{field:"matches",headerName:"Matches",description:"number of matches found in the full term list"},{field:"senses",headerName:"Senses",description:"number of directly associated senses"},{field:"related",headerName:"Related",description:"number of similar terms on record, based on agreement between embeddings spaces"},{field:"ncats",headerName:"Categories",description:"number of categories the term has weight in"}];return r.forEach(s=>e.push({field:"category_"+s,headerName:s,editable:!0,valueParser:(e,s)=>{let n=+e||"";return s&&t(n,s),n}})),e},[r,t]),[m,x]=(0,l.useState)([]),[p,g]=(0,l.useState)(0),y=(0,l.useMemo)(()=>{if(c.length<1e3)return!1;let e=m.map(e=>{let{id:t}=e;return t}).sort();return!(2>Math.abs(e.length-c.length))&&e.join()!==c.join()},[m,c]);(0,l.useEffect)(()=>{s.termAssociations&&s.synsetInfo&&t4(a,s,y?g:void 0).then(e=>{x(e.sort(tQ)),y&&g(0)})},[a,s,y]);let[j,f]=(0,l.useState)("");return(0,n.jsxs)(em.Z,{component:"main",sx:{height:"100%"},children:[c.length?y?(0,n.jsx)(eH.Z,{open:!0,children:(0,n.jsxs)(d.Z,{direction:"column",sx:{textAlign:"center"},children:[(0,n.jsx)(u.Z,{variant:"h4",children:"Processing Dictionary"}),(0,n.jsx)(eV.Z,{variant:"determinate",value:100*p}),(0,n.jsx)(u.Z,{variant:"caption",children:p?Math.round(100*p)+"%":"preparing..."})]})}):(0,n.jsx)(tY,{rows:m,columns:h,isCategory:i,setEditCategory:f,editFromEvent:t}):(0,n.jsx)(u.Z,{align:"center",children:"Add terms, or import an existing dictionary."}),(0,n.jsx)(tI,{category:j,onClose:()=>f("")})]})}let t1={},t2={};async function t5(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,r=s[t.source[1]in s?t.source[1]:"all"];for(let s,i="";n.length<a&&(s=t.exec(r));)(i=s[0].replace(b,""))&&(n.push(i),!e||i in t2||(t2[i]=e))}function t3(e,t,s){s.forEach((s,n)=>{e[n]=!0,t[n]=!0})}function t8(e,t){try{return new RegExp(e,t)}catch(t){return e}}function t9(e,t,s,n){let a="string"==typeof e&&s&&e in s,r=a&&s[e].term?s[e].term:e,i=a&&"regex"===s[e].type?"regex":"fixed",l=r+"_"+i;l in t1||(t1[l]=function(e,t){let s="string"==typeof e;if(s&&!y.test(e))return function(e,t){let{terms:s,lemmas:n,termLookup:a,termAssociations:r,synsetInfo:i}=t,l={type:"fixed",term:e,term_type:"fixed",categories:{},recognized:!1,index:s&&a&&a[e]||-1,lemma:[],related:[],synsets:[],synset_terms:[],lookup:{expanded:!1,map:new Map,any:{},lemma:{},lemma_map:new Map,lemma_related:{},lemma_synset:{},related:{},related_map:new Map,related_lemma:{},related_related:{},related_synset:{},synset:{},synset_map:new Map,synset_lemma:{},synset_related:{},synset_synset:{}}};if(r&&i&&n&&s&&-1!==l.index){l.recognized=!0;let t=r[l.index];l.related=t&&t[0]&&Array.isArray(t[0])?t[0].filter((e,t)=>!!t).map(e=>s[e-1]):[],l.synsets=t&&t[1]?(Array.isArray(t[1])?t[1]:[t[1]]).map(e=>i[e-1]):[];let a=new Set;l.synsets.forEach(e=>{e3(e,s,i).forEach(e=>{e!==l.term&&a.add(e)})}),l.synset_terms=Array.from(a);let o=s&&n&&e in n?n["number"==typeof n[e]?s[n[e]]:e]:[];l.lemma="number"==typeof o?[s[o]]:o.map(e=>s[e]),function(e){let{lemma:t,related:s,synset_terms:n,lookup:a}=e;t.forEach(e=>{a.any[e]=!0,a.lemma[e]=!0,a.lemma_map.set(e,!0)}),s.forEach(e=>{a.any[e]=!0,a.related[e]=!0,a.related_map.set(e,!0)}),n.forEach(e=>{a.any[e]=!0,a.synset[e]=!0,a.synset_map.set(e,!0)})}(l)}return l}(e,t);{let n=s?v(e):e.source,a={type:"fuzzy",term_type:s?"glob":"regex",term:s?e:e.source,categories:{},recognized:!1,regex:t8(s?n:k(n),"g"),matches:[]};return t.collapsedTerms&&t5(a.term,a.regex,t.collapsedTerms,a.matches),a.recognized=!!a.matches.length,a}}("regex"===i?t8(r):r,t));let o=t1[l];return n&&"fixed"===o.type&&!o.lookup.expanded&&function(e,t){let s=e.lookup,n=s.any;e.lemma.forEach(e=>{let a=t9(e,t).lookup;t3(n,s.lemma_related,a.related_map),t3(n,s.lemma_synset,a.synset_map)}),e.related.forEach(e=>{let a=t9(e,t).lookup;t3(n,s.related_lemma,a.lemma_map),t3(n,s.related_related,a.related_map),t3(n,s.related_synset,a.synset_map)}),e.synset_terms.forEach(e=>{let a=t9(e,t).lookup;t3(n,s.synset_lemma,a.lemma_map),t3(n,s.synset_related,a.related_map),t3(n,s.synset_synset,a.synset_map)}),s.expanded=!0,s.map=new Map(Object.keys(n).map(e=>[e,!0]))}(o,t),o}async function t6(e,t,s,n,a){let r=t9(s,a,n),i=n[s],l="fixed"===r.type?{processed:r,dictEntry:i,id:s,term:i.term||s,sense:i.sense,matches:r.recognized?1:0,ncats:Object.keys(i.categories).length,frequency:w(r.index,a.terms&&a.terms.length).toFixed(2),senses:r.synsets.length,related:r.related.length}:{processed:r,dictEntry:i,id:s,term:i.term||s,sense:i.sense,matches:r.matches.length,ncats:Object.keys(i.categories).length};if(i.categories){let e=i.categories;Object.keys(e).forEach(t=>{l["category_"+t]=e[t]})}e[t]=l}async function t4(e,t,s){return clearTimeout(tX.dictionary),new Promise(n=>{let a=Object.freeze(Object.keys(e)),r=a.length,i=Array(r),l=0,o=0,c=()=>{for(clearTimeout(tX.dictionary);l<r&&o<1e3;l++,o++)t6(i,l,a[l],e,t);l!==r?(o=0,s&&s(l/r),tX.dictionary=setTimeout(c,0)):(s&&s(1),n(i))};tX.dictionary=setTimeout(c,0)})}function t7(e){let{selected:t,setSelected:s,multi:a,useNLTK:r,editCell:i,params:o}=e,{synsetInfo:c,SenseLookup:d,collapsedSenses:h,NLTKLookup:m,collapsedNLTK:x}=(0,l.useContext)(Y),[p,g]=(0,l.useState)([]),[y,b]=(0,l.useState)(""),Z=r?m:d;return c?(0,n.jsx)(eI.Z,{componentsProps:{popper:{className:"synset-select"}},multiple:a,autoSelect:!0,options:p,onKeyUp:e=>{let s=("value"in e.target?e.target.value:"").toLowerCase(),n=[];if(s){let e;try{e=RegExp(j.test(s)?v(s):";"+s+"[^;]*;","g")}catch(t){e=RegExp(";"+s.replace(f,"\\%&")+";","g")}t5("",e,{all:r?x:h},n,100)}t.forEach(e=>{n.includes(e)||n.push(e)}),g(n)},value:a?t:t[0],onChange:(e,t)=>{if(t){let e="string"==typeof t?[t]:[...t];i&&o&&i({...o,newValue:e}),s(e)}},renderTags:(e,t)=>e.map((e,s)=>(0,l.createElement)(eR.Z,{label:e,...t({index:s}),key:e})),renderInput:e=>(0,n.jsx)(ex.Z,{...e,size:"small",label:"Fine Senses",value:y,onChange:e=>{t.includes(e.target.value)||b(e.target.value)}}),renderOption:(e,t)=>{if(t in Z){delete e.key;let{definition:s}=c[(r?m:d)[t]];return(0,n.jsx)(eE.Z,{value:t,...e,children:(0,n.jsx)(eh.Z,{title:s,placement:"right",children:(0,n.jsx)(u.Z,{sx:{width:"100%"},children:t})})},t)}},noOptionsText:"No matches",filterSelectedOptions:!0,selectOnFocus:!0,clearOnBlur:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0}):(0,n.jsx)(n.Fragment,{})}function se(e,t){let s=e.split("||"),n=s[0],a={...t},r=a[n];return 1===r.length?delete a[n]:(r.splice(+s[2],1),a[n]=[...r]),{newMap:a,fine:s[0],coarse:s[1],index:s[2]}}function st(e){let{params:t,labels:s,senseMap:a,updateSenseMap:r}=e,[i,o]=(0,l.useState)("");return(0,n.jsx)(eI.Z,{componentsProps:{popper:{className:"synset-select"}},disableCloseOnSelect:!0,options:s,value:t.value,onChange:(e,s)=>{let{newMap:n,fine:i}=se(t.id,a);i in n?n[i].push(s):n[i]=[s],r(n),t.api.setEditCellValue({...t,value:s})},inputValue:i,onInputChange:(e,t)=>o(t),renderInput:e=>(0,n.jsx)(ex.Z,{...e,size:"small",label:"Coarse Senses"}),filterSelectedOptions:!0,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,freeSolo:!0})}function ss(){let[e,t]=(0,l.useState)(!1),s=()=>t(!e),{senseMap:a,synsetInfo:r,SenseLookup:i}=(0,l.useContext)(Y),o=(0,l.useContext)(X),c=(0,l.useMemo)(()=>{let e=new Set;return Object.values(a).forEach(t=>t.forEach(t=>t&&e.add(t))),Object.freeze(Array.from(e))},[a]),[h,m]=(0,l.useState)(!1),x=(0,l.useMemo)(()=>[{field:"remove",headerName:"",width:1,sortable:!1,disableColumnMenu:!0,renderCell:e=>(0,n.jsx)(ea.Z,{sx:{opacity:.4,cursor:"not-allowed"},size:"small","aria-label":"remove term",onClick:()=>{let{newMap:t}=se(e.id,a);o(t)},children:(0,n.jsx)(eD.Z,{sx:{fontSize:".9em"}})})},{field:"fine",headerName:"Fine",width:180,hideable:!1,editable:!0,renderEditCell:e=>(0,n.jsx)(t7,{selected:[e.value],setSelected:t=>{let{newMap:s,coarse:n}=se(e.id,a),r=t[0];r in s?s[r].push(n):s[r]=[n],o(s)},multi:!1,useNLTK:h,editCell:e.api.setEditCellValue,params:e})},{field:"coarse",headerName:"Coarse",width:125,hideable:!1,editable:!0,renderEditCell:e=>(0,n.jsx)(st,{params:e,labels:c,senseMap:a,updateSenseMap:o})},{field:"definition",headerName:"Fine Definition",width:210}],[a]),p=(0,l.useMemo)(()=>{let e=[];return r&&Object.keys(a).forEach((t,s)=>{let n=a[t],l=r[i[t]];n.forEach(n=>{e.push({id:t+"||"+n+"||"+s,fine:h?l.nltk_id:t,definition:l.definition,coarse:n,info:l})})}),e},[a,r,h]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{variant:"outlined",onClick:s,children:"Edit"}),(0,n.jsxs)(ey.Z,{open:e,onClose:s,children:[(0,n.jsx)(ej.Z,{children:"Sense Map Editor"}),(0,n.jsx)(ea.Z,{"aria-label":"close sense map editor",onClick:s,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{sx:{p:1},children:(0,n.jsxs)(d.Z,{sx:{height:"500px"},spacing:1,children:[(0,n.jsx)(ed.Z,{control:(0,n.jsx)(eu.Z,{size:"small",checked:h,onChange:()=>m(!h)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"NLTK-Style Labels"}),labelPlacement:"start"}),(0,n.jsx)(eL._$,{className:"datagrid-vertical",rows:p,columns:x,disableRowSelectionOnClick:!0,disableDensitySelector:!0,disableColumnSelector:!0,pageSizeOptions:[100],density:"compact",editMode:"row",slots:{toolbar:eK.T}}),(0,n.jsx)(eq,{coarseLabels:c,useNLTK:h})]})})]})]})}function sn(){let e=(0,l.useContext)(sl),t=(0,l.useContext)(si),s=(0,l.useContext)(X),{senseMap:a}=(0,l.useContext)(Y),[r,i]=(0,l.useState)(!1),o=()=>i(!r),c=(0,l.useContext)(sp),[h,m]=(0,l.useState)(t.undo||"z"),[x,p]=(0,l.useState)(t.redo||"x"),[g,y]=(0,l.useState)(!!t.disable_storage),[j,f]=(0,l.useState)(!!t.use_db),b={undo:m,redo:p},Z=(0,l.useCallback)(e=>{if((e.ctrlKey||e.metaKey)&&(!e.target||!("tagName"in e.target)||"INPUT"!==e.target.tagName))switch(e.key){case x:c(-1);break;case h:c(1)}},[h,x,c]);(0,l.useEffect)(()=>(window.addEventListener("keydown",Z),()=>{window.removeEventListener("keydown",Z)}),[Z]);let v=s=>{let n=s.target.name;if(n&&n in b){let a=s.target.value;window.removeEventListener("keydown",Z),t[n]=a,b[n](a),e({...t}),localStorage.setItem("dictionary_builder_settings",JSON.stringify(t))}},C=Object.keys(a).length;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ea.Z,{onClick:o,"aria-label":"toggle settings menu",children:(0,n.jsx)(es.Z,{})}),(0,n.jsx)(er.ZP,{anchor:"right",open:r,onClose:o,children:(0,n.jsxs)(ei.Z,{sx:{height:"100%",width:"12em",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,n.jsx)(el.Z,{title:(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Settings"}),action:(0,n.jsx)(ea.Z,{onClick:o,"aria-label":"close settings menu",className:"close-button",children:(0,n.jsx)(en.Z,{})})}),(0,n.jsxs)(eo.Z,{sx:{alignContent:"left",mb:"auto",p:0,"& .MuiPaper-root":{ml:.5,mr:.5,mb:1,p:.5}},children:[(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Storage"}),(0,n.jsx)(ec.Z,{elevation:3,children:(0,n.jsxs)(d.Z,{spacing:1,children:[(0,n.jsx)(ed.Z,{label:"Disable","aria-label":"disable storage",labelPlacement:"start",sx:{justifyContent:"space-between"},control:(0,n.jsx)(eu.Z,{checked:g,size:"small",onChange:s=>{t.disable_storage=!g,e({...t}),localStorage.setItem("dictionary_builder_settings",JSON.stringify(t)),y(!g)}})}),g?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(eh.Z,{title:"IndexedDB can store larger dictionaries, but it may be a bit slower.",children:(0,n.jsx)(ed.Z,{label:"IndexedDB",labelPlacement:"start",sx:{justifyContent:"space-between"},control:(0,n.jsx)(eu.Z,{checked:j,size:"small",onChange:s=>{t.use_db=!j,e({...t}),localStorage.setItem("dictionary_builder_settings",JSON.stringify(t)),f(!j)}})})})]})}),(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Keybinds"}),(0,n.jsx)(ec.Z,{elevation:3,children:(0,n.jsxs)(em.Z,{children:[(0,n.jsx)(u.Z,{variant:"caption",children:"CTRL + "}),(0,n.jsxs)(d.Z,{spacing:2,children:[(0,n.jsx)(ex.Z,{size:"small",label:"Undo",name:"undo",value:h,onChange:v}),(0,n.jsx)(ex.Z,{size:"small",label:"Redo",name:"redo",value:x,onChange:v})]})]})}),(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Coarse Senses"}),(0,n.jsx)(ec.Z,{elevation:3,children:(0,n.jsxs)(d.Z,{spacing:1,children:[(0,n.jsx)(eM,{}),(0,n.jsx)(ss,{}),C?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(u.Z,{children:["Mapped senses: ",(0,n.jsxs)("span",{className:"number",children:[C," "]})]}),(0,n.jsx)(eW,{}),(0,n.jsx)(eZ,{label:"Remove",message:"The stored coarse sense map will be deleted.",onConfirm:()=>{K("coarse_sense_map",""),s({})}})]}):(0,n.jsx)(n.Fragment,{})]})})]}),(0,n.jsx)(ep.Z,{children:(0,n.jsxs)(d.Z,{spacing:2,children:[(0,n.jsx)(eg.Z,{variant:"contained",color:"warning",onClick:()=>{indexedDB.deleteDatabase("dictionary_builder_resources"),location.reload()},children:"Refresh Resources"}),(0,n.jsx)(eZ,{label:"Clear Storage",message:"Clearing storage will delete all settings, dictionaries, and edit history.",onConfirm:()=>{t.dictionary_names&&t.dictionary_names.forEach(e=>{K(e,"dict_"),K(e,"dict_history_")}),localStorage.removeItem("dictionary_builder_settings"),window.location.reload()}})]})})]})})]})}var sa=s(46730);function sr(){let e=(0,l.useContext)(sm),t=(0,l.useContext)(sx),s=(0,l.useContext)(sp),a=(0,l.useMemo)(()=>e.edits.map((t,a)=>(0,n.jsx)(m.ZP,{sx:{p:0},children:(0,n.jsx)(sa.Z,{sx:{borderLeft:e.position>=a?"2px solid #fff":""},onClick:()=>s(a-e.position),children:(0,n.jsx)(tR.Z,{sx:{m:0},primary:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(u.Z,{children:[(0,n.jsx)("span",{style:{opacity:".75"},children:t.type+": "}),t.name]}),"edit_term"===t.type?(0,n.jsx)(u.Z,{className:"code",sx:{wordBreak:"break-all"},children:"categories"===t.value.field?t.value.edits.map(e=>e.category+": "+e.from+" -> "+e.to).join("\n"):t.value.field+": "+t.value.original+" -> "+t.value.new}):"rename_category"===t.type?(0,n.jsxs)(u.Z,{className:"code",children:["From ",t.originalName]}):(0,n.jsx)(n.Fragment,{})]}),secondary:(0,n.jsx)(u.Z,{sx:{fontSize:".8em",opacity:.6},variant:"body2",children:t.time?new Date(t.time).toLocaleString():""})})})},a)),[e,s]);return(0,n.jsxs)(ei.Z,{elevation:5,sx:{height:"60%",minHeight:"300px",position:"relative",display:"flex",flexDirection:"column"},children:[(0,n.jsx)(el.Z,{title:(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Edit History"}),sx:{pb:0}}),(0,n.jsxs)(d.Z,{direction:"row",sx:{position:"absolute",top:8,right:8},children:[(0,n.jsx)(ea.Z,{onClick:()=>s(1),"aria-label":"undo",children:(0,n.jsx)(tK.Z,{})}),(0,n.jsx)(ea.Z,{onClick:()=>s(-1),"aria-label":"redo",children:(0,n.jsx)(tB.Z,{})}),(0,n.jsx)(ea.Z,{onClick:()=>s(-1e3),"aria-label":"jump to current",children:(0,n.jsx)(tq.Z,{})})]}),(0,n.jsx)(eo.Z,{sx:{p:0,mb:"auto",overflowY:"auto"},children:(0,n.jsx)(h.Z,{sx:{overflowX:"hidden"},children:a})}),(0,n.jsx)(ep.Z,{children:(0,n.jsx)(eg.Z,{variant:"contained",color:"warning",fullWidth:!0,onClick:()=>{t({type:"clear"})},children:"Clear"})})]})}let si=(0,l.createContext)({selected:"default",dictionary_names:["default"],info_drawer_height:30,term_editor_width:200,use_db:!0}),sl=(0,l.createContext)(e=>{}),so=(0,l.createContext)(e=>{}),sc=(0,l.createContext)({}),sd=(0,l.createContext)(e=>{}),su=(0,l.createContext)([]),sh=(0,l.createContext)(e=>{}),sm=(0,l.createContext)({edits:[],position:-1}),sx=(0,l.createContext)(e=>{}),sp=(0,l.createContext)(e=>{}),sg=(0,l.createContext)(""),sy=()=>async e=>{},sj=(0,l.createContext)((e,t)=>{}),sf=(0,l.createContext)(async e=>{}),sb={};function sZ(e,t){return e.toLowerCase()>t.toLowerCase()?1:-1}function sv(e){let{children:t}=e,[s,a]=(0,l.useState)(""),[r,i]=(0,l.useState)(sy),o=(e,t)=>{t?(a(e),i(t)):(a(""),i(sy))},c=(0,l.useContext)(X);(0,l.useEffect)(()=>{$(c,o)},[]);let[d,u]=(0,l.useState)(function(){let e=localStorage.getItem("dictionary_builder_settings"),t=e?JSON.parse(e):{dictionary_names:["default"],selected:"default",use_db:!0};return t.dictionary_names||(t.dictionary_names=["default"]),t.selected&&t.dictionary_names.includes(t.selected)||(t.selected="default"),"use_db"in t||(t.use_db=!0),t}()),h=!!d.use_db,m=e=>{J(e,t=>{Z({type:"change_dict",name:e,dict:t})},o,h)},x=e=>{if("replace"===e.type){g(e.history);return}let t="clear"===e.type?[]:[...p.edits],s="clear"===e.type?-1:p.position;"remove"===e.type?t.pop():"clear"!==e.type&&(s>-1&&(t.splice(0,s+1),s=-1),e.entry.time||(e.entry.time=Date.now()),t.splice(0,0,e.entry)),t.length>1e3&&t.splice(1e3,t.length-999),d.disable_storage||B(d.selected,"dict_history_",{edits:t,position:s},h),g({edits:t,position:s})},[p,g]=(0,l.useState)({edits:[],position:-1}),y=e=>{var t,s,n,a;"delete"===e.type?("default"!==e.name&&d.dictionary_names.splice(d.dictionary_names.indexOf(e.name),1),d.selected="default",u({...d}),K(e.name,"dict_"),K(e.name,"dict_history_"),t=e.name,delete G[t],m("default")):(d.dictionary_names.includes(e.name)||d.dictionary_names.push(e.name),d.selected=e.name,"set"===e.type)?m(e.name):(d.disable_storage||(s=e.name,n=e.dict,a=e.password,G[s]=n,B(s,"dict_",n,h,a)),"add"===e.type&&Z({type:"change_dict",name:e.name,dict:e.dict})),localStorage.setItem("dictionary_builder_settings",JSON.stringify(d))},[j,f]=(0,l.useReducer)((e,t)=>{let s=e;if("collect"===t.type){let n=new Set(t.reset?[]:e);Object.keys(t.dictionary).forEach(e=>{let s=t.dictionary[e];s&&s.categories&&Object.keys(s.categories).forEach(e=>n.add(e))}),s=Array.from(n).sort(sZ)}else"add"===t.type?e.includes(t.cat)||(s=[...e,t.cat].sort(sZ)):s=e.filter(e=>e!==t.cat);return e.length!==s.length||e.join("")!==s.join("")?s:e},[]),[b,Z]=(0,l.useReducer)((e,t)=>{if("history_bulk"===t.type)return f({type:"collect",dictionary:t.dict,reset:!0}),y({type:"save",name:d.selected,dict:t.dict}),t.dict;if("change_dict"===t.type){var s;return s=t.dict,sb={},Object.keys(s).forEach(e=>{let t=s[e],n=t.term||e;t.term=n,n in sb?e!==n&&sb[n].add(e):sb[n]=new Set}),U(t.name,e=>x({type:"replace",history:e}),o,h),f({type:"collect",dictionary:t.dict,reset:!0}),t.dict}let n={...e};if("rename_category"===t.type){let e=0;Object.keys(n).forEach(s=>{let a=n[s];t.name in a.categories&&(e++,a.categories[t.name]&&(a.categories[t.newName]=a.categories[t.name]),delete a.categories[t.name])}),f({type:"remove",cat:t.name}),f({type:"add",cat:t.newName}),e&&x({type:"add",entry:{type:"rename_category",name:t.newName,originalName:t.name}})}else if("remove_category"===t.type){let e={},s=0;Object.keys(n).forEach(a=>{let r=n[a];t.name in r.categories&&(s++,r.categories[t.name]&&(e[a]=r.categories[t.name]),delete r.categories[t.name])}),s&&x({type:"add",entry:{type:"remove_category",name:t.name,weights:e}})}else if("add_category"===t.type)Object.keys(t.weights).forEach(e=>{e in n&&(t.weights[e]?n[e].categories[t.name]=t.weights[e]:delete n[e].categories[t.name])}),x({type:"add",entry:t});else if("reweight_category"===t.type){let e={},s=0;Object.keys(n).forEach(a=>{let r=n[a];r.categories[t.name]!==t.weights[a]&&(s++,e[a]=r.categories[t.name]||0,t.weights[a]?r.categories[t.name]=t.weights[a]:delete r.categories[t.name])}),s&&x({type:"add",entry:{...t,originalWeights:e}})}else{if("remove"===t.type)delete n[t.term_id],x({type:"add",entry:{type:"remove_term",name:t.term_id,value:e[t.term_id]}});else{let s="string"==typeof t.term?t.term:t.term.source;t.term_id||("add"===t.type?s in sb?(t.term_id=s+(sb[s].size+1),sb[s].add(t.term_id)):sb[s]=new Set:t.term_id=s);let a=t.term_id||s,r=n[a]||{};if(n[a]={term:s,added:r.added||t.added||Date.now(),type:t.term_type||r.type||"fixed",categories:{...t.categories||r.categories||{}},sense:"sense"in t?t.sense||"":r.sense||""},"replace"===t.type){let s="string"==typeof t.originalTerm?t.originalTerm:t.originalTerm.source;delete n[s],x({type:"add",entry:{type:"replace_term",name:a,value:n[a],originalName:s,originalValue:e[s]}})}else if(a in e){let t;let s=e[a],r=n[a];if(s.sense&&r.sense!==s.sense)t={field:"sense",new:r.sense,original:s.sense};else{let e=[];Object.keys(r.categories).forEach(t=>{r.categories[t]!==s.categories[t]&&e.push({category:t,from:s.categories[t]||0,to:r.categories[t]||0})}),Object.keys(s.categories).forEach(t=>{t in r.categories||e.push({category:t,from:s.categories[t],to:0})}),e.length?t={field:"categories",edits:e}:r.sense!==s.sense&&(t={field:"sense",new:r.sense,original:s.sense})}t&&x({type:"add",entry:{type:"edit_term",name:a,value:t}})}else x({type:"add",entry:{type:"add_term",name:a,value:n[a]}})}f({type:"collect",dictionary:n})}return y({type:"save",name:d.selected,dict:n}),n},{});return(0,l.useEffect)(()=>{d.dictionary_names.includes(d.selected)||(d.selected="default"),m(d.selected)},[]),(0,n.jsx)(si.Provider,{value:d,children:(0,n.jsx)(sl.Provider,{value:u,children:(0,n.jsx)(sg.Provider,{value:s,children:(0,n.jsx)(sj.Provider,{value:o,children:(0,n.jsx)(sf.Provider,{value:r,children:(0,n.jsx)(sm.Provider,{value:p,children:(0,n.jsx)(sx.Provider,{value:x,children:(0,n.jsx)(so.Provider,{value:y,children:(0,n.jsx)(sc.Provider,{value:b,children:(0,n.jsx)(su.Provider,{value:j,children:(0,n.jsx)(sd.Provider,{value:Z,children:(0,n.jsx)(sh.Provider,{value:f,children:(0,n.jsx)(sp.Provider,{value:e=>{let t=Math.min(Math.max(-1,p.position+e),p.edits.length-1);if(t!==p.position){let e={...b},s={...p};(function(e,t,s){let n=t.position;if(e>t.position)for(n=Math.max(0,n);n<e+1;n++)t.edits[n]&&function(e,t){switch(e.type){case"add_term":delete t[e.name];return;case"remove_term":t[e.name]=e.value;return;case"replace_term":delete t[e.name],t[e.originalName]=e.originalValue;return;case"edit_term":if("categories"===e.value.field){let s={...t[e.name]};e.value.edits.forEach(e=>{e.from?s.categories[e.category]=e.from:delete s.categories[e.category]})}else t[e.name][e.value.field]=e.value.original;return;case"add_category":Object.keys(t).forEach(s=>{let n=t[s];Object.keys(n.categories).forEach(t=>{t in e.weights&&delete n.categories[t]})});return;case"remove_category":Object.keys(t).forEach(s=>{s in e.weights&&(t[s].categories[e.name]=e.weights[s])});return;case"reweight_category":Object.keys(t).forEach(s=>{e.originalWeights[s]?t[s].categories[e.name]=e.originalWeights[s]:delete t[s].categories[e.name]});return;case"rename_category":Object.keys(t).forEach(s=>{let n=t[s];e.name in n.categories&&(n.categories[e.name]&&(n.categories[e.originalName]=n.categories[e.name]),delete n.categories[e.name])});return}}(t.edits[n],s);else for(n=Math.min(t.edits.length-1,n);n>e;n--)t.edits[n]&&function(e,t){switch(e.type){case"add_term":t[e.name]=e.value;return;case"remove_term":delete t[e.name];return;case"replace_term":delete t[e.originalName],t[e.name]=e.value;return;case"edit_term":if("categories"===e.value.field){let s={...t[e.name]};e.value.edits.forEach(e=>{e.to?s.categories[e.category]=e.to:delete s.categories[e.category]})}else t[e.name][e.value.field]=e.value.new;return;case"add_category":Object.keys(t).forEach(s=>{s in e.weights&&(t[s].categories[e.name]=e.weights[s])});return;case"remove_category":Object.keys(t).forEach(s=>{let n=t[s];n&&n.categories&&e.name in n.categories&&delete n.categories[e.name]});return;case"reweight_category":Object.keys(t).forEach(s=>{e.weights[s]?t[s].categories[e.name]=e.weights[s]:delete t[s].categories[e.name]});return;case"rename_category":Object.keys(t).forEach(s=>{let n=t[s];e.originalName in n.categories&&(n.categories[e.originalName]&&(n.categories[e.name]=n.categories[e.originalName]),delete n.categories[e.originalName])});return}}(t.edits[n],s);t.position=e})(t,s,e),x({type:"replace",history:s}),d.disable_storage||B(d.selected,"dict_history_",s,h),Z({type:"history_bulk",dict:e})}},children:t})})})})})})})})})})})})})}var sC=s(4598),sw=s(18645);let s_={type:"graph",layout:"force",size_by_value:!0,hide_zeros:!1,label_threshold:0,repulsion:100,gravity:.1,edge_length:40},sk={include_fuzzy:!1,dense:!1,min_sim:.001};function sS(e,t){let s={...e};return e[t.key],s[t.key]=t.value,s}function sE(){let e=(0,l.useContext)(sc),t=(0,l.useContext)(su),s=(0,l.useMemo)(()=>{let e=[...t];return e.includes("no categories")||e.push("no categories"),e},[t]),[a,r]=(0,l.useReducer)(sS,s_),[i,o]=(0,l.useReducer)(sS,sk),[c,p]=(0,l.useState)([]);(0,l.useEffect)(()=>{p(c.filter(e=>s.includes(e)))},[s]);let{allTerms:g,catCounts:y}=(0,l.useMemo)(()=>{let t={},s=new Map(Object.keys(e).map(s=>{let n=Object.keys(e[s].categories);return(n.length?n:["no categories"]).forEach(e=>{e in t?t[e]++:t[e]=1}),[e[s].term||s,e[s]]}));return{catCounts:t,allTerms:s}},[e]);return(0,n.jsxs)(d.Z,{direction:"row",sx:{height:"100%"},children:[(0,n.jsx)(em.Z,{sx:{height:"100%",minWidth:"250px",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:(0,n.jsxs)(em.Z,{sx:{pl:1,pr:1,height:"100%",display:"flex",flexDirection:"column"},children:[(0,n.jsxs)(em.Z,{sx:{overflowY:"auto"},children:[(0,n.jsx)(u.Z,{variant:"h6",children:"Terms"}),(0,n.jsx)(h.Z,{dense:!0,sx:{overflowY:"auto",overflowX:"hidden",maxHeight:"300px",p:0},children:Object.keys(y).map(e=>(0,n.jsx)(m.ZP,{disablePadding:!0,disableGutters:!0,children:(0,n.jsxs)(sa.Z,{disableGutters:!0,"aria-label":"toggle category",onClick:()=>{let t=[...c],s=t.indexOf(e);-1===s?t.push(e):t.splice(s,1),p(t)},children:[(0,n.jsx)(x.Z,{sx:{minWidth:"35px"},children:(0,n.jsx)(sw.Z,{sx:{p:0},checked:c.includes(e)})}),(0,n.jsx)(tR.Z,{sx:{m:0},primary:e,secondary:y[e]+" terms"})]})},e))}),(0,n.jsxs)(t_.Z,{sx:{justifyContent:"space-between"},variant:"dense",disableGutters:!0,children:[(0,n.jsxs)(d.Z,{direction:"row",children:[(0,n.jsx)(eg.Z,{size:"small",sx:{minWidth:"1px"},onClick:()=>{p([...s])},children:"All"}),(0,n.jsx)(eg.Z,{size:"small",sx:{minWidth:"1px"},onClick:()=>{p([])},children:"None"})]}),(0,n.jsx)(u.Z,{sx:{pr:1,whiteSpace:"nowrap"},children:c.length+" / "+s.length+" selected"})]}),(0,n.jsxs)(d.Z,{spacing:2,children:[(0,n.jsx)(eh.Z,{title:"Include all matches to fuzzy terms in the comparison.",placement:"right",children:(0,n.jsx)(ed.Z,{label:"Fuzzy Matches",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{size:"small",checked:i.include_fuzzy,onChange:()=>o({key:"include_fuzzy",value:!i.include_fuzzy})})})}),(0,n.jsx)(eh.Z,{title:"Include second-order term relationships in similarity calculations, resulting in a denser network.",placement:"right",children:(0,n.jsx)(ed.Z,{label:"Secondary Connections",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{size:"small",checked:i.dense,onChange:()=>o({key:"dense",value:!i.dense})})})}),(0,n.jsx)(eh.Z,{title:"Will consider nodes with similarity equal to or less than this as unconnected.",placement:"right",children:(0,n.jsx)(ex.Z,{value:i.min_sim,type:"number",size:"small",label:"Similarity Threshold",onChange:e=>o({key:"min_sim",value:e.target.value})})})]})]}),(0,n.jsxs)(em.Z,{sx:{overflowY:"auto"},children:[(0,n.jsx)(u.Z,{variant:"h6",sx:{mt:2},children:"Plot Options"}),(0,n.jsxs)(d.Z,{spacing:2,children:[(0,n.jsx)(ed.Z,{label:"Hide Zeros",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{size:"small",checked:a.hide_zeros,onChange:()=>r({key:"hide_zeros",value:!a.hide_zeros})})}),(0,n.jsx)(ed.Z,{label:"Size By Value",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{size:"small",checked:a.size_by_value,onChange:()=>r({key:"size_by_value",value:!a.size_by_value})})}),(0,n.jsx)(eh.Z,{title:"Will not show labels for nodes with values lower than this.",placement:"right",children:(0,n.jsx)(ex.Z,{value:a.label_threshold,type:"number",size:"small",label:"Label Threshold",onChange:e=>r({key:"label_threshold",value:e.target.value})})}),"graph"===a.type?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e_.Z,{fullWidth:!0,children:[(0,n.jsx)(ek.Z,{id:"graph_layout_select",children:"Layout"}),(0,n.jsxs)(eS.Z,{labelId:"graph_layout_select",label:"Layout",size:"small",value:a.layout||"force",onChange:e=>{r({key:"layout",value:e.target.value})},children:[(0,n.jsx)(e0.Z,{children:"Canvas"}),(0,n.jsx)(eE.Z,{value:"none",children:"Random"}),(0,n.jsx)(eE.Z,{value:"circular",children:"Circular"}),(0,n.jsx)(eE.Z,{value:"force",children:"Force"}),(0,n.jsx)(e0.Z,{children:"WebGL"}),(0,n.jsx)(eE.Z,{value:"forceAtlas2",children:"ForceAtlas2"})]})]}),"force"===a.layout?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eh.Z,{title:"Repulsion factor between nodes.",placement:"right",children:(0,n.jsx)(ex.Z,{value:a.repulsion,type:"number",size:"small",label:"Repulsion",onChange:e=>r({key:"repulsion",value:e.target.value})})}),(0,n.jsx)(eh.Z,{title:"Nodes' strength of attraction to the center.",placement:"right",children:(0,n.jsx)(ex.Z,{value:a.gravity,type:"number",size:"small",label:"Gravity",onChange:e=>r({key:"gravity",value:e.target.value})})}),(0,n.jsx)(eh.Z,{title:"Base distance between nodes.",placement:"right",children:(0,n.jsx)(ex.Z,{value:a.edge_length,type:"number",size:"small",label:"Edge Length",onChange:e=>r({key:"edge_length",value:e.target.value})})})]}):(0,n.jsx)(n.Fragment,{})]}):(0,n.jsx)(n.Fragment,{})]})]})]})}),(0,n.jsx)(tW,{allTerms:g,catCounts:y,selectedCategories:c,options:i,plotOptions:a})]})}var sO=s(53082),sz=s(22158),sN=s(278),sF=s(11736);function sP(e){let{setName:t,setContent:s}=e,a=(0,l.useContext)(sj),r=(0,l.useContext)(si),[i,o]=(0,l.useState)(!1),c=()=>o(!i);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eh.Z,{title:"select an existing dictionary to import as a copy",children:(0,n.jsx)(eg.Z,{variant:"outlined",onClick:c,children:"Copy"})}),i&&(0,n.jsxs)(ey.Z,{open:i,onClose:c,children:[(0,n.jsx)(ej.Z,{children:"Copy Dictionary"}),(0,n.jsx)(ea.Z,{"aria-label":"close export menu",onClick:c,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{sx:{p:0},children:(0,n.jsx)(h.Z,{sx:{p:0,pb:2},children:r.dictionary_names.map(e=>(0,n.jsx)(m.ZP,{sx:{p:0},children:(0,n.jsx)(sa.Z,{onClick:()=>J(e,n=>{t(r.dictionary_names.includes(e+" Copy")?e+" Copy"+(1e4*Math.random()>>0):e+" Copy"),s(JSON.stringify(n,void 0,2)),c()},a,!!r.use_db),children:e})},e))})})]})]})}let sM=(0,ew.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),sT=/\t/,sA=/\s\s/,sW=/^\s+|\s+$/g,sD=/^["\s]+|["\s]+$/g,sI=/\s{2,}|\t+/g,sR=/[[({]/,sL=/[\])}]/,sK=/([\[\]\(\)?^$.+])/;function sB(e,t,s,n,a){return{added:n,type:a&&function(e){if(!sK.test(e))return!1;let t=sR.test(e),s=sL.test(e);return t&&s||!t&&!s}(e)?"regex":"fixed",categories:t,sense:s||"",term:e}}function sq(){let e=(0,eT.Z)(),t=(0,l.useContext)(so),[s,a]=(0,l.useState)(""),[r,i]=(0,l.useState)(!1),o=()=>i(!r),[c,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)(!1),[x,p]=(0,l.useState)(""),[y,j]=(0,l.useState)(""),[f,b]=(0,l.useState)(!0),Z=()=>{a(""),p(""),j("")},v=()=>{s&&(t({type:"add",name:s,dict:function(e,t){let s=Date.now(),n={},a=e=>{let t=e;return e in n?(t+=n[e].size+1,n[e].add(t)):n[e]=new Set,t},r={};if(e)try{if("%"===e[0]){let n=e.split(g),i={},l=n.length;if(l>1){let e=1;for(e=1;e<l;e++){let t=n[e].replace(sW,"");if("%"===t)break;let s=t.split(sI);s.length>1&&s[1]&&(i[s[0]]=s[1])}for(e++;e<l;e++){let o=n[e].replace(sW,"").split(sI);if(o.length>1){let n=o.splice(0,1)[0].toLowerCase();if(n){let c={};o.forEach(e=>{e in i&&(c[i[e]]=1)});let[d,u]=n.split("@");r[a(d)]=sB(d,c,u,s-l+e,t)}}}}}else if("{"===e[0]){let n=JSON.parse(e),i=Object.keys(n);if(i.length&&"type"in n[i[0]]&&"string"==typeof n[i[0]].type)return n;let l=0;i.forEach(e=>{if(e){let i=n[e];Array.isArray(i)?(l+=i.length,i.forEach((n,i)=>{if(n){let[o,c]=n.toLowerCase().split("@"),d=a(o);d in r?r[d].categories[e]=1:r[d]=sB(o,{[e]:1},c,s-l+i,t)}})):Object.keys(i).forEach((n,o)=>{if(l++,n){let[c,d]=n.toLowerCase().split("@"),u=a(c);u in r?r[u].categories[e]=i[n]:r[u]=sB(c,{[e]:i[c]},d,s-l+o,t)}})}})}else{let n=e.split(g),i=sT.test(n[0])?"	":sA.test(n[0])?"  ":",",l=n.splice(0,1)[0].split(i).map(e=>e.replace(sD,""));l.splice(0,1);let o="term_sense"===l[0],c=n.length;n.forEach((e,n)=>{let d=e.split(i).map(e=>e.replace(sD,"")),u=d.splice(0,1)[0].toLowerCase();if(u){let e="",i={};d.forEach((t,s)=>{if(t&&l[s]){let n=+t;!e&&(o&&0===s||isNaN(n))?e=t:i[l[s]]=+t}}),r[a(u)]=sB(u,i,e,s-c+n,t)}})}}catch(e){}return r}(x,c),password:h?y:""}),Z(),i(!1))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{variant:"outlined",onClick:o,children:"New"}),(0,n.jsxs)(ey.Z,{open:r,onClose:o,onDrop:e=>{if(e.preventDefault(),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){let t=e.dataTransfer.files[0],s=new FileReader;s.onload=()=>{a(E(t.name)),p(s.result)},s.readAsText(t)}},children:[(0,n.jsx)(ej.Z,{children:"Add Dictionary"}),(0,n.jsx)(ea.Z,{"aria-label":"close import menu",onClick:o,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{sx:{p:1},children:(0,n.jsxs)(d.Z,{spacing:1,children:[(0,n.jsx)(ex.Z,{size:"small",label:"Name",value:s,onKeyDown:e=>{(s&&"Enter"===e.code||"NumpadEnter"===e.code)&&v()},onChange:e=>{a(e.target.value)}}),(0,n.jsxs)(e_.Z,{children:[(0,n.jsx)(eA.Z,{sx:{fontSize:".8em"},htmlFor:"import_content",children:"Import Content"}),(0,n.jsx)("textarea",{id:"import_content",style:{backgroundColor:e.palette.background.default,color:e.palette.text.primary,whiteSpace:x?"pre":"normal",minWidth:"30em",minHeight:"20em"},value:x,onChange:e=>{p(e.target.value)},placeholder:"drag and drop a file, or enter content directly; see export menu for format examples"})]}),(0,n.jsx)(eh.Z,{title:"Attempt to convert terms to regular expressions if they contain special RegEx characters.",placement:"top",children:(0,n.jsx)(ed.Z,{label:"Detect RegEx",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{checked:c,onChange:()=>u(!c)})})}),(0,n.jsx)(eh.Z,{title:"Encrypt dictionary and history when being stored.",placement:"right",children:(0,n.jsx)(ed.Z,{label:"Encrypt",labelPlacement:"start",control:(0,n.jsx)(eu.Z,{checked:h,onChange:()=>m(!h)})})}),h?(0,n.jsxs)(em.Z,{children:[(0,n.jsx)(ex.Z,{fullWidth:!0,size:"small",label:"Password",type:f?"password":"text",value:y,onChange:e=>j(e.target.value)}),(0,n.jsx)(ea.Z,{sx:{position:"absolute",right:15},"aria-label":"toggle password visibility",onClick:()=>b(!f),children:f?(0,n.jsx)(ev.Z,{}):(0,n.jsx)(eC.Z,{})})]}):(0,n.jsx)(n.Fragment,{})]})}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsxs)(d.Z,{direction:"row",spacing:1,children:[(0,n.jsx)(sP,{setName:a,setContent:p}),(0,n.jsx)(eh.Z,{title:"select a file to import a dictionary from",children:(0,n.jsxs)(eg.Z,{variant:"outlined",component:"label",children:["File",(0,n.jsx)(sM,{type:"file",onChange:e=>{if(e.target.files&&e.target.files.length){let t=e.target.files[0],s=new FileReader;s.onload=()=>{a(E(t.name)),p(s.result),e.target.value=""},s.readAsText(t)}}})]})}),(0,n.jsx)(eh.Z,{title:"clear current content",children:(0,n.jsx)(eg.Z,{onClick:Z,children:"clear"})})]}),(0,n.jsx)(eg.Z,{variant:"contained",disabled:!!h&&!y,onClick:v,children:"Add"})]})]})]})}let sH=/\.\w{3,4}$/i;function sV(){let e=(0,eT.Z)(),t=(0,l.useContext)(si),s=(0,l.useContext)(sc),[a,r]=(0,l.useState)(!1),i=()=>r(!a),[o,c]=(0,l.useState)("dic"),[h,m]=(0,l.useState)("csv"),[x,p]=(0,l.useState)(t.selected),[g,y]=(0,l.useState)("unweighted"),[j,f]=(0,l.useState)(!1),b=(0,l.useMemo)(()=>a?function(e,t,s,n,a){switch(t){case"tabular":let r=function(e){switch(e){case"csv":return",";case"tsv":return"	";default:return"  "}}(s),i=new Set;Object.values(e).forEach(e=>{let t=e.categories;t&&Object.keys(t).forEach(e=>i.add(e))});let l=Array.from(i),o=new Map(l.map((e,t)=>[t,e]));return'"term"'+r+'"'+(a?'term_sense"'+r+'"':"")+l.join('"'+r+'"')+'"\n'+Object.keys(e).map(t=>{let s=e[t],n=s.categories,i='"'+(s.term||t)+'"';return a&&(i+=r+s.sense),o.forEach(e=>{i+=r+(e in n?n[e]:"")}),i}).join("\n");case"dic":let c={},d=0,u="";return Object.keys(e).forEach(t=>{let s=e[t],n=s.categories;if(n){let e=[s.term||t];a&&s.sense&&(e[0]+="@"+s.sense),Object.keys(n).forEach(t=>{t in c||(c[t]=++d),e.push(c[t])}),u+="\n"+e.join("	")}}),"%\n"+Object.keys(c).map(e=>c[e]+"	"+e).join("\n")+"\n%"+u;case"json":if("full"===n)return JSON.stringify(e,void 0,2);let h={};if(Object.keys(e).forEach(t=>{let s=e[t],n=s.categories;if(n){let e=s.term||t;a&&s.sense&&(e+="@"+s.sense),Object.keys(n).forEach(t=>{t in h||(h[t]={}),h[t][e]=n[t]})}}),"weighted"===n)return JSON.stringify(h,void 0,2);let m={};return Object.keys(h).forEach(e=>{m[e]=Object.keys(h[e])}),JSON.stringify(m,void 0,2);default:return""}}(s,o,h,g,j):"",[a,s,o,h,g,j]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eg.Z,{variant:"outlined",onClick:i,children:"Export"}),a&&(0,n.jsxs)(ey.Z,{open:a,onClose:i,children:[(0,n.jsx)(ej.Z,{children:"Export Dictionary"}),(0,n.jsx)(ea.Z,{"aria-label":"close export menu",onClick:i,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsx)(ef.Z,{sx:{p:1},children:(0,n.jsxs)(d.Z,{spacing:1,children:[(0,n.jsx)(ex.Z,{size:"small",label:"Filename",value:x,onChange:e=>{p(e.target.value)}}),(0,n.jsxs)(e_.Z,{children:[(0,n.jsx)(eA.Z,{sx:{fontSize:".8em"},htmlFor:"export_content",children:"Export Content"}),(0,n.jsx)("textarea",{id:"export_content",style:{backgroundColor:e.palette.background.default,color:e.palette.text.primary,whiteSpace:"pre",minWidth:"35em",minHeight:"20em"},value:b,readOnly:!0})]})]})}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsxs)(d.Z,{direction:"row",spacing:1,children:["json"!==o||"full"!==g?(0,n.jsx)(ed.Z,{sx:{transform:"translate(0, -10px)"},control:(0,n.jsx)(eu.Z,{size:"small",checked:j,onChange:()=>f(!j)}),label:(0,n.jsx)(u.Z,{variant:"caption",children:"Senses"}),labelPlacement:"top"}):(0,n.jsx)(n.Fragment,{}),(0,n.jsxs)(e_.Z,{children:[(0,n.jsx)(ek.Z,{id:"export_format",children:"Format"}),(0,n.jsxs)(eS.Z,{labelId:"export_format",label:"Format",size:"small",value:o,onChange:e=>{c(e.target.value)},children:[(0,n.jsx)(eE.Z,{value:"dic",children:"DIC"}),(0,n.jsx)(eE.Z,{value:"json",children:"JSON"}),(0,n.jsx)(eE.Z,{value:"tabular",children:"Tabular"})]})]}),"tabular"===o?(0,n.jsxs)(e_.Z,{children:[(0,n.jsx)(ek.Z,{id:"export_separator",children:"Type"}),(0,n.jsxs)(eS.Z,{labelId:"export_separator",label:"Type",size:"small",value:h,onChange:e=>{m(e.target.value)},children:[(0,n.jsx)(eE.Z,{value:"csv",children:"CSV"}),(0,n.jsx)(eE.Z,{value:"tsv",children:"TSV"}),(0,n.jsx)(eE.Z,{value:"dat",children:"DAT"})]})]}):(0,n.jsx)(n.Fragment,{})," ","json"===o?(0,n.jsxs)(e_.Z,{children:[(0,n.jsx)(ek.Z,{id:"export_json_type",children:"Type"}),(0,n.jsxs)(eS.Z,{labelId:"export_json_type",label:"Type",size:"small",value:g,onChange:e=>{y(e.target.value)},children:[(0,n.jsx)(eE.Z,{value:"weighted",children:"Weighted"}),(0,n.jsx)(eE.Z,{value:"unweighted",children:"Unweighted"}),(0,n.jsx)(eE.Z,{value:"full",children:"Full"})]})]}):(0,n.jsx)(n.Fragment,{})]}),(0,n.jsx)(eg.Z,{variant:"contained",onClick:()=>{if(x&&b){let e=document.createElement("a");e.setAttribute("href",URL.createObjectURL(new Blob([b],{type:"text/plain"}))),e.setAttribute("download",x.replace(sH,"")+"."+("tabular"===o?h:o)),document.body.appendChild(e),e.click(),document.body.removeChild(e)}},children:"Download"})]})]})]})}function sG(){let e=(0,l.useContext)(si),[t,s]=(0,l.useState)(!1),a=()=>s(!t),[r,i]=(0,l.useState)(""),o=(0,l.useContext)(so),c=(0,l.useContext)(su),x=(0,l.useContext)(sh),p=(0,l.useContext)(sd),[g,y]=(0,l.useState)(""),j=()=>{g&&-1===c.indexOf(g)&&(x({type:"add",cat:g}),y(""))},f=(0,l.useMemo)(()=>c.map(e=>(0,n.jsx)(m.ZP,{disablePadding:!0,disableGutters:!0,secondaryAction:(0,n.jsx)(ea.Z,{"aria-label":"delete category",sx:{opacity:.5},onClick:()=>{p({type:"remove_category",name:e}),x({type:"remove",cat:e})},children:(0,n.jsx)(eD.Z,{})}),children:(0,n.jsx)(sa.Z,{dense:!0,onClick:()=>i(e),children:(0,n.jsx)(tR.Z,{primary:e})})},e)),[c,p,x]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Z,{direction:"row",children:[(0,n.jsx)(ea.Z,{onClick:a,children:(0,n.jsx)(sF.Z,{})}),(0,n.jsx)(u.Z,{sx:{display:{sm:"block",xs:"none"},fontSize:{md:"1.2em",sm:".8em"},maxWidth:{md:"285px",sm:"150px"},overflow:"hidden",textOverflow:"ellipsis",alignSelf:"center"},noWrap:!0,children:e.selected})]}),(0,n.jsx)(er.ZP,{anchor:"left",open:t,onClose:a,children:(0,n.jsxs)(ei.Z,{sx:{height:"100%",width:"20em",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,n.jsx)(el.Z,{title:(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Dictionary Menu"}),action:(0,n.jsx)(ea.Z,{onClick:a,"aria-label":"close dictionary menu",className:"close-button",children:(0,n.jsx)(en.Z,{})})}),(0,n.jsxs)(d.Z,{direction:"row",sx:{mb:2},children:[(0,n.jsxs)(e_.Z,{fullWidth:!0,children:[(0,n.jsx)(ek.Z,{id:"dictionary_select",children:"Current"}),(0,n.jsx)(eS.Z,{labelId:"dictionary_select",label:"Current",size:"small",value:e.selected,onChange:e=>{o({type:"set",name:e.target.value})},children:e.dictionary_names.map(e=>(0,n.jsx)(eE.Z,{value:e,children:e},e))})]}),(0,n.jsx)(sq,{})]}),(0,n.jsx)(eo.Z,{sx:{alignContent:"left",mb:"auto",pt:0,pb:1,height:"100%",overflow:"hidden"},children:(0,n.jsxs)(d.Z,{spacing:1,sx:{height:"100%",overflowY:"auto"},children:[(0,n.jsxs)(ei.Z,{elevation:5,sx:{height:"40%",minHeight:"300px",display:"flex",flexDirection:"column"},children:[(0,n.jsx)(el.Z,{title:(0,n.jsx)(u.Z,{fontWeight:"bold",children:"Categories"}),sx:{pb:0}}),(0,n.jsx)(eo.Z,{sx:{p:0,mb:"auto",overflowY:"auto"},children:(0,n.jsx)(h.Z,{dense:!0,children:f})}),(0,n.jsx)(ep.Z,{children:(0,n.jsxs)(d.Z,{direction:"row",children:[(0,n.jsx)(ex.Z,{label:"New Category Name",size:"small",value:g,onKeyDown:e=>{("Enter"===e.code||"NumpadEnter"===e.code)&&j()},onChange:e=>{y(e.target.value)}}),(0,n.jsx)(eg.Z,{variant:"contained",onClick:j,children:"Add"})]})})]}),(0,n.jsx)(sr,{})]})}),(0,n.jsx)(ep.Z,{children:(0,n.jsxs)(d.Z,{direction:"column",sx:{width:"100%"},spacing:1,children:[(0,n.jsx)(sV,{}),(0,n.jsx)(eZ,{label:"Delete",message:"Delete the "+e.selected+" dictionary?",onConfirm:()=>{o({type:"delete",name:e.selected})}})]})})]})}),(0,n.jsx)(tI,{category:r,onClose:()=>i("")})]})}function sU(e){let{terms:t,asTable:s,setAsTable:a,add:r}=e,[i,o]=(0,l.useState)(""),[c,u]=(0,l.useState)(""),[h,m]=(0,l.useState)(!1),[x,p]=(0,l.useState)([]),[g,y]=(0,l.useState)(!1),b=(0,l.useContext)(tn),{collapsedTerms:Z}=(0,l.useContext)(Y),C=e=>{let t=e?"string"==typeof e?e:"innerText"in e.target?e.target.innerText:i:i;if(t){if(g){let e=t;try{e=new RegExp(e)}catch(e){}r(e,"regex")}else r(t,"fixed");p([]),o("")}},w=e=>{let t=e.target;if(t&&"value"in t&&"innerText"in t){let e=t["string"==typeof t.value?"value":"innerText"].toLowerCase();m(e in sb),o(e)}else o("")};return(0,n.jsx)(sN.Z,{component:"nav",children:(0,n.jsxs)(t_.Z,{variant:"dense",sx:{justifyContent:"space-between"},disableGutters:!0,children:[(0,n.jsx)(sG,{}),(0,n.jsxs)(d.Z,{direction:"row",sx:{width:{sm:"calc(min(500px, 50%))",xs:"100%"}},spacing:{md:1,sm:0},children:[(0,n.jsx)(eI.Z,{options:x,value:i,onHighlightChange:(e,t)=>u(t||""),onKeyUp:e=>{if(("Enter"===e.code||"NumpadEnter"===e.code)&&(!c||c===i))return C(i);c!==i&&w(e)},onChange:w,renderInput:e=>(0,n.jsx)(ex.Z,{...e,size:"small",placeholder:"Term Search",value:i,onChange:e=>{w(e);let s=e.target.value;if(t){let e=[];if(s&&Z){let t;try{t=RegExp(g?k(s):j.test(s)?v(s):";"+s+"[^;]*;","g")}catch(e){t=RegExp(";"+s.replace(f,"\\%&")+";","g")}t5("",t,Z,e,100)}p(e)}},color:h?"warning":"primary"}),filterOptions:e=>e,selectOnFocus:!0,clearOnBlur:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,freeSolo:!0}),(0,n.jsx)(eh.Z,{title:"regular expression characters are "+(g?"active":"escaped"),children:(0,n.jsx)(ea.Z,{"aria-label":"toggle regular expression",onClick:()=>y(!g),children:g?(0,n.jsx)(sO.Z,{}):(0,n.jsx)(sz.Z,{})})}),(0,n.jsx)(eg.Z,{sx:{display:{sm:"block",xs:"none"}},variant:"outlined",disabled:!i,onClick:()=>{i&&(b({type:"add",state:{type:"term",value:i}}),h&&tJ(i))},children:"View"}),(0,n.jsx)(eg.Z,{variant:"contained",onClick:()=>C(),disabled:!i,children:"Add"})]}),(0,n.jsxs)(d.Z,{direction:"row",children:[(0,n.jsx)(eg.Z,{variant:"outlined",sx:{width:{md:100,sm:70},p:{md:1,sm:0},display:{sm:"block",xs:"none"}},onClick:()=>a(!s),children:s?"Analyze":"Edit"}),(0,n.jsx)(sn,{})]})]})})}function sJ(){let e=(0,l.useContext)(sg),t=(0,l.useContext)(sf),s=(0,l.useContext)(sj),a=(0,l.useContext)(so),[r,i]=(0,l.useState)(!1),[o,c]=(0,l.useState)(!0),d=!1,h=()=>{i(!1),x(""),s(""),!d&&e&&"coarse_sense_map"!==e&&a({type:"set",name:"default"}),t("")},[m,x]=(0,l.useState)(""),p=()=>{m&&(i(!1),t(m).then(()=>{d=!0,s(""),x("")}).catch(()=>{x(""),i(!0)}))};return(0,n.jsxs)(ey.Z,{open:!!e,onClose:h,children:[(0,n.jsx)(ej.Z,{children:"Encrypted Resource"}),(0,n.jsx)(ea.Z,{"aria-label":"close export menu",onClick:h,sx:{position:"absolute",right:8,top:12},className:"close-button",children:(0,n.jsx)(en.Z,{})}),(0,n.jsxs)(ef.Z,{sx:{p:1},children:[(0,n.jsxs)(u.Z,{sx:{mb:2},children:["The ",(0,n.jsx)("span",{className:"number",children:e})," resource is encrypted."]}),(0,n.jsx)(ex.Z,{fullWidth:!0,label:"Password",size:"small",type:o?"password":"text",value:m,error:r,onKeyDown:e=>{("Enter"===e.code||"NumpadEnter"===e.code)&&p()},onChange:e=>{x(e.target.value)}}),(0,n.jsx)(ea.Z,{sx:{position:"absolute",right:15},"aria-label":"toggle password visibility",onClick:()=>c(!o),children:o?(0,n.jsx)(ev.Z,{}):(0,n.jsx)(eC.Z,{})})]}),(0,n.jsxs)(eb.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsx)(eg.Z,{onClick:h,children:"Cancel"}),(0,n.jsx)(eg.Z,{variant:"contained",onClick:p,disabled:!m,children:"Decrypt"})]})]})}let s$=/^category_/;function sY(){let[e,t]=(0,l.useState)(!0),s=(0,l.useContext)(sc),a=(0,l.useContext)(su),{terms:r}=(0,l.useContext)(Y),i=(0,l.useContext)(sd),o=(0,l.useCallback)((e,t)=>{let{field:s,row:n}=t,{processed:a,dictEntry:r}=n,l="from_term_editor"===s;if(s&&(l||s.startsWith("category_"))){let t={...r.categories},o=l?n.id:s.replace(s$,"");o in t&&!e?delete t[o]:e&&(t[o]=e),i({type:"update",term_id:n[l?"term_id":"id"],term:a.term,term_type:a.term_type,categories:t,sense:r.sense})}},[i]),c=(0,l.useContext)(e7),d=(0,l.useContext)(ts),u=c in s,h=(0,l.useContext)(si),[m,x]=(0,l.useState)(h.info_drawer_height||30),p=d.length?m:0;return(0,n.jsxs)(sC.Z,{children:[(0,n.jsx)(sU,{terms:r,asTable:e,setAsTable:t,add:(e,t)=>{i({type:"add",term:e,term_type:t})}}),(0,n.jsxs)(em.Z,{sx:{position:"absolute",top:0,left:0,bottom:0,right:(u?h.term_editor_width||200:0)+"px",mt:"3em",mb:p+"vh"},children:[e?(0,n.jsx)(t0,{editFromEvent:o}):(0,n.jsx)(sE,{}),u?(0,n.jsx)(tt,{categories:a,editor:o,width:h.term_editor_width||200}):(0,n.jsx)(n.Fragment,{}),(0,n.jsx)(tl,{height:m,setHeight:x})]}),(0,n.jsx)(sJ,{})]})}let sX=(0,a.Z)({palette:{mode:"dark",primary:{main:"#b393d3"},success:{main:"#4986cb"},error:{main:"#e0561c"}}}),sQ=-1;function s0(){window.dispatchEvent(new Event("resize"))}let s1=(e,t)=>{switch("reset"!==t.type&&e.length||(cancelAnimationFrame(sQ),sQ=requestAnimationFrame(s0)),t.type){case"add":return e.length&&e[0].value===t.state.value?[...e]:[t.state,...e];case"back":return[...e].splice(1,e.length);default:return[]}};function s2(){let[e,t]=(0,l.useReducer)(s1,[]),[s,a]=(0,l.useState)("");return(0,n.jsx)(l.StrictMode,{children:(0,n.jsxs)(r.Z,{theme:sX,children:[(0,n.jsx)(i.ZP,{}),(0,n.jsx)(et,{children:(0,n.jsx)(sv,{children:(0,n.jsx)(ts.Provider,{value:e,children:(0,n.jsx)(tn.Provider,{value:t,children:(0,n.jsx)(e7.Provider,{value:s,children:(0,n.jsx)(te.Provider,{value:(e,t)=>{(s||t)&&e||(cancelAnimationFrame(sQ),sQ=requestAnimationFrame(s0)),tJ(e),a(e)},children:(0,n.jsx)(sY,{})})})})})})})]})})}}},function(e){e.O(0,[414,971,69,744],function(){return e(e.s=46919)}),_N_E=e.O()}]);